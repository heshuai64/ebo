Ext.override(QoDesk.Attention,{createWindow:function(){var n=this.app.getDesktop();var i=n.getWindow("attention-win");var h=new Date();h.setDate(h.getDate()-7);var b=new Date();var l=new Ext.data.JsonStore({root:"records",totalProperty:"totalCount",idProperty:"id",baseParams:{start_date:h,end_date:b},fields:["id","txnId","transactionTime","status","amountCurrency","amountValue","payeeId","payerId"],url:"connect.php?moduleId=qo-attention&action=getUnmapTransaction"});function f(o,s,q){return lang.attention.transactions_status_json[o]}function g(q,t,s){if(q>0){var o="green"}else{var o="red"}return String.format('<font color="'+o+'">{0} {1}</font>',s.data.amountCurrency,q)}var e=new Ext.grid.GridPanel({autoHeight:true,store:l,autoScroll:true,columns:[{header:lang.attention.grid_transactions_payee_id,dataIndex:"payeeId",width:110,align:"center",sortable:true},{header:lang.attention.grid_transactions_id,dataIndex:"id",width:110,align:"center",sortable:true},{header:lang.attention.grid_payer_id,dataIndex:"payerId",width:120,align:"center",sortable:true},{header:lang.attention.grid_txn_id,dataIndex:"txnId",width:120,align:"center",sortable:true},{header:lang.attention.grid_transactions_time,dataIndex:"transactionTime",width:150,align:"center",sortable:true},{header:lang.attention.grid_amount,dataIndex:"amountValue",width:100,renderer:g,align:"center",sortable:true},{header:lang.attention.grid_status,dataIndex:"status",width:100,renderer:f,align:"center",sortable:true}],tbar:[{xtype:"tbtext",text:"Seller:"},{id:"payeeId",xtype:"combo",mode:"local",store:new Ext.data.JsonStore({autoLoad:true,fields:["id","name"],url:"connect.php?moduleId=qo-transactions&action=getSeller"}),valueField:"id",displayField:"name",triggerAction:"all",editable:false,selectOnFocus:true,name:"sellerId",hiddenName:"sellerId"},{xtype:"tbseparator"},{xtype:"tbtext",text:"Start Date:"},{xtype:"datefield",id:"start_date",name:"start_date",format:"Y-m-d",value:h},{xtype:"tbseparator"},{xtype:"tbtext",text:"End Date:"},{xtype:"datefield",id:"end_date",name:"end_date",format:"Y-m-d",value:b},{xtype:"tbbutton",text:"Submit",disabled:(get_cookie("qo-attention.getUnmapTransaction")==0)?true:false,handler:function(){l.baseParams={payeeId:document.getElementById("payeeId").value,start_date:document.getElementById("start_date").value,end_date:document.getElementById("end_date").value};l.load({params:{start:0,limit:20}})}}],bbar:new Ext.PagingToolbar({pageSize:20,store:l,displayInfo:true})});e.on("rowdblclick",function(p){var o=p.getSelectionModel().getSelected();window.open("/eBayBO/transactions.php?id="+o.data.id,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1000, height=800")});var k=new Ext.data.JsonStore({root:"records",totalProperty:"totalCount",idProperty:"id",baseParams:{start_date:h,end_date:b},fields:["id","txnId","transactionTime","status","amountCurrency","amountValue","payeeId","payerId","createdBy","createdOn","transactionReason"],url:"connect.php?moduleId=qo-attention&action=getWaitingAuditRefund"});function m(o,s,q){return lang.attention.transactions_reason_json[o]}var j=new Ext.grid.GridPanel({autoHeight:true,store:k,autoScroll:true,columns:[{header:lang.attention.grid_transactions_id,dataIndex:"id",width:110,align:"center",sortable:true},{header:lang.attention.grid_created_by,dataIndex:"createdBy",width:120,align:"center",sortable:true},{header:lang.attention.grid_created_on,dataIndex:"createdOn",width:150,align:"center",sortable:true},{header:lang.attention.grid_amount,dataIndex:"amountValue",width:100,renderer:g,align:"center",sortable:true},{header:lang.attention.grid_transactions_reason,dataIndex:"transactionReason",width:100,renderer:m,align:"center",sortable:true}],tbar:[{xtype:"tbtext",text:"Seller:"},{id:"waitingAuditRefundPayeeId",xtype:"combo",mode:"local",store:new Ext.data.JsonStore({autoLoad:true,fields:["id","name"],url:"connect.php?moduleId=qo-transactions&action=getSeller"}),valueField:"id",displayField:"name",triggerAction:"all",editable:false,selectOnFocus:true,name:"sellerId",hiddenName:"sellerId"},{xtype:"tbseparator"},{xtype:"tbtext",text:"Start Date:"},{xtype:"datefield",id:"waiting_wudit_refund_start_date",name:"start_date",format:"Y-m-d",value:h},{xtype:"tbseparator"},{xtype:"tbtext",text:"End Date:"},{xtype:"datefield",id:"waiting_wudit_refund_end_date",name:"end_date",format:"Y-m-d",value:b},{xtype:"tbbutton",text:"Submit",disabled:(get_cookie("qo-attention.getWaitingAuditRefund")==0)?true:false,handler:function(){k.baseParams={payeeId:document.getElementById("waitingAuditRefundPayeeId").value,start_date:document.getElementById("waiting_wudit_refund_start_date").value,end_date:document.getElementById("waiting_wudit_refund_end_date").value};k.load({params:{start:0,limit:20}})}}],bbar:new Ext.PagingToolbar({pageSize:20,store:k,displayInfo:true})});j.on("rowdblclick",function(p){var o=p.getSelectionModel().getSelected();window.open("/eBayBO/transactions.php?id="+o.data.id,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1000, height=800")});var d=new Ext.data.JsonStore({root:"records",totalProperty:"totalCount",idProperty:"id",baseParams:{start_date:h,end_date:b},fields:["id","shipmentReason","shippingFeeCurrency","shippingFeeValue","createdBy","createdOn"],url:"connect.php?moduleId=qo-attention&action=getWaitDealShipment"});function c(o,s,q){return String.format("{0} {1}",q.data.shippingFeeCurrency,o)}var a=new Ext.grid.GridPanel({autoHeight:true,store:d,autoScroll:true,columns:[{header:lang.attention.wait_deal_shipment_id,dataIndex:"id",width:110,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_reason,dataIndex:"shipmentReason",width:150,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_shipping_fee,dataIndex:"shippingFeeValue",width:120,renderer:c,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_created_by,dataIndex:"createdBy",width:120,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_created_on,dataIndex:"createdOn",width:120,align:"center",sortable:true}],bbar:new Ext.PagingToolbar({pageSize:20,store:d,displayInfo:true})});a.on("rowdblclick",function(p){var o=p.getSelectionModel().getSelected();window.open("/eBayBO/shipments.php?id="+o.data.id,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1000, height=800")});if(!i){i=n.createWindow({id:"attention-win",title:lang.attention.window_title,width:830,height:550,iconCls:"attention-icon",shim:false,animCollapse:false,constrainHeader:true,layout:"fit",autoScroll:true,items:[{xtype:"panel",collapsible:true,title:lang.attention.un_map_transaction_grid_title,autoHeight:true,items:e},{xtype:"panel",collapsible:true,title:lang.attention.waiting_audit_refund_grid_title,autoHeight:true,items:j}],taskbuttonTooltip:"<b>注意</b><br />系统提醒"})}i.show()}});