Ext.override(QoDesk.Attention,{createWindow:function(){function g(a,b,c){return String.format('<font color="'+(a>0?"green":"red")+'">{0} {1}</font>',c.data.amountCurrency,a)}var h=this.app.getDesktop(),f=h.getWindow("attention-win"),b=new Date;b.setDate(b.getDate()-7);var c=new Date,d=new Ext.data.JsonStore({root:"records",totalProperty:"totalCount",idProperty:"id",baseParams:{start_date:b,end_date:c},fields:"id,txnId,transactionTime,status,amountCurrency,amountValue,payeeId,payerId".split(","),url:"connect.php?moduleId=qo-attention&action=getUnmapTransaction"}),
i=new Ext.grid.GridPanel({autoHeight:true,store:d,autoScroll:true,columns:[{header:lang.attention.grid_transactions_payee_id,dataIndex:"payeeId",width:110,align:"center",sortable:true},{header:lang.attention.grid_transactions_id,dataIndex:"id",width:110,align:"center",sortable:true},{header:lang.attention.grid_payer_id,dataIndex:"payerId",width:120,align:"center",sortable:true},{header:lang.attention.grid_txn_id,dataIndex:"txnId",width:120,align:"center",sortable:true},{header:lang.attention.grid_transactions_time,
dataIndex:"transactionTime",width:150,align:"center",sortable:true},{header:lang.attention.grid_amount,dataIndex:"amountValue",width:100,renderer:g,align:"center",sortable:true},{header:lang.attention.grid_status,dataIndex:"status",width:100,renderer:function(a){return lang.attention.transactions_status_json[a]},align:"center",sortable:true}],tbar:[{xtype:"tbtext",text:"Seller:"},{id:"payeeId",xtype:"combo",mode:"local",store:new Ext.data.JsonStore({autoLoad:true,fields:["id","name"],url:"connect.php?moduleId=qo-transactions&action=getSeller"}),
valueField:"id",displayField:"name",triggerAction:"all",editable:false,selectOnFocus:true,name:"sellerId",hiddenName:"sellerId"},{xtype:"tbseparator"},{xtype:"tbtext",text:"Start Date:"},{xtype:"datefield",id:"start_date",name:"start_date",format:"Y-m-d",value:b},{xtype:"tbseparator"},{xtype:"tbtext",text:"End Date:"},{xtype:"datefield",id:"end_date",name:"end_date",format:"Y-m-d",value:c},{xtype:"tbbutton",text:"Submit",disabled:get_cookie("qo-attention.getUnmapTransaction")==0?true:false,handler:function(){d.baseParams=
{payeeId:document.getElementById("payeeId").value,start_date:document.getElementById("start_date").value,end_date:document.getElementById("end_date").value};d.load({params:{start:0,limit:20}})}}],bbar:new Ext.PagingToolbar({pageSize:20,store:d,displayInfo:true})});i.on("rowdblclick",function(a){a=a.getSelectionModel().getSelected();window.open("/eBayBO/transactions.php?id="+a.data.id,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1000, height=800")});
var e=new Ext.data.JsonStore({root:"records",totalProperty:"totalCount",idProperty:"id",baseParams:{start_date:b,end_date:c},fields:"id,txnId,transactionTime,status,amountCurrency,amountValue,payeeId,payerId,createdBy,createdOn,transactionReason".split(","),url:"connect.php?moduleId=qo-attention&action=getWaitingAuditRefund"}),j=new Ext.grid.GridPanel({autoHeight:true,store:e,autoScroll:true,columns:[{header:lang.attention.grid_transactions_id,dataIndex:"id",width:110,align:"center",sortable:true},
{header:lang.attention.grid_created_by,dataIndex:"createdBy",width:120,align:"center",sortable:true},{header:lang.attention.grid_created_on,dataIndex:"createdOn",width:150,align:"center",sortable:true},{header:lang.attention.grid_amount,dataIndex:"amountValue",width:100,renderer:g,align:"center",sortable:true},{header:lang.attention.grid_transactions_reason,dataIndex:"transactionReason",width:100,renderer:function(a){return lang.attention.transactions_reason_json[a]},align:"center",sortable:true}],
tbar:[{xtype:"tbtext",text:"Seller:"},{id:"waitingAuditRefundPayeeId",xtype:"combo",mode:"local",store:new Ext.data.JsonStore({autoLoad:true,fields:["id","name"],url:"connect.php?moduleId=qo-transactions&action=getSeller"}),valueField:"id",displayField:"name",triggerAction:"all",editable:false,selectOnFocus:true,name:"sellerId",hiddenName:"sellerId"},{xtype:"tbseparator"},{xtype:"tbtext",text:"Start Date:"},{xtype:"datefield",id:"waiting_wudit_refund_start_date",name:"start_date",format:"Y-m-d",value:b},
{xtype:"tbseparator"},{xtype:"tbtext",text:"End Date:"},{xtype:"datefield",id:"waiting_wudit_refund_end_date",name:"end_date",format:"Y-m-d",value:c},{xtype:"tbbutton",text:"Submit",disabled:get_cookie("qo-attention.getWaitingAuditRefund")==0?true:false,handler:function(){e.baseParams={payeeId:document.getElementById("waitingAuditRefundPayeeId").value,start_date:document.getElementById("waiting_wudit_refund_start_date").value,end_date:document.getElementById("waiting_wudit_refund_end_date").value};
e.load({params:{start:0,limit:20}})}}],bbar:new Ext.PagingToolbar({pageSize:20,store:e,displayInfo:true})});j.on("rowdblclick",function(a){a=a.getSelectionModel().getSelected();window.open("/eBayBO/transactions.php?id="+a.data.id,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1000, height=800")});b=new Ext.data.JsonStore({root:"records",totalProperty:"totalCount",idProperty:"id",baseParams:{start_date:b,end_date:c},
fields:"id,shipmentReason,shippingFeeCurrency,shippingFeeValue,createdBy,createdOn".split(","),url:"connect.php?moduleId=qo-attention&action=getWaitDealShipment"});(new Ext.grid.GridPanel({autoHeight:true,store:b,autoScroll:true,columns:[{header:lang.attention.wait_deal_shipment_id,dataIndex:"id",width:110,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_reason,dataIndex:"shipmentReason",width:150,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_shipping_fee,
dataIndex:"shippingFeeValue",width:120,renderer:function(a,b,c){return String.format("{0} {1}",c.data.shippingFeeCurrency,a)},align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_created_by,dataIndex:"createdBy",width:120,align:"center",sortable:true},{header:lang.attention.wait_deal_shipment_created_on,dataIndex:"createdOn",width:120,align:"center",sortable:true}],bbar:new Ext.PagingToolbar({pageSize:20,store:b,displayInfo:true})})).on("rowdblclick",function(a){a=a.getSelectionModel().getSelected();
window.open("/eBayBO/shipments.php?id="+a.data.id,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1000, height=800")});f||(f=h.createWindow({id:"attention-win",title:lang.attention.window_title,width:830,height:550,iconCls:"attention-icon",shim:false,animCollapse:false,constrainHeader:true,layout:"fit",autoScroll:true,items:[{xtype:"panel",collapsible:true,title:lang.attention.un_map_transaction_grid_title,autoHeight:true,
items:i},{xtype:"panel",collapsible:true,title:lang.attention.waiting_audit_refund_grid_title,autoHeight:true,items:j}],taskbuttonTooltip:"<b>\u6ce8\u610f</b><br />\u7cfb\u7edf\u63d0\u9192"}));f.show()}});
