Ext.onReady(function(){Ext.BLANK_IMAGE_URL="../../Ext/2.2/resources/images/default/s.gif";var a=new Ext.state.CookieProvider({path:"/eBayBO/analyze/",expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(a);com.ebay.widgets.needs({baseUrl:"http://w-1.ebay.com/js/607/min/",files:["FindItemsAdvanced.js","GetSingleItem.js"],resources:[].concat(com.ebay.shoppingservice.Shopping.getSingleItem,com.ebay.shoppingservice.Shopping.findItemsAdvanced),callback:function(){var b=new Ext.data.ArrayReader({},[{name:"itemID"},{name:"userID"},{name:"title"},{name:"buyItNowAvailable"},{name:"currentPrice"},{name:"shippingServiceCost"},{name:"quantity"},{name:"quantitySold"},{name:"galleryURL"},{name:"startTime"},{name:"endTime",type:"date",dateFormat:"y-m-d H:i:s"},{name:"listingType"},{name:"listingStatus"}]);var d=new Ext.data.Store({reader:b});function h(i,l,k){return String.format('<img src="{0}"/>',i)}function c(i,l,k){if(i.substr(3)=="0"||i.substr(3)==0){return String.format('<font color="red">{0}</font>',i)}else{return String.format('<font color="green">{0}</font>',i)}}function f(i,l,k){return k.data.endTime.getElapsed(k.data.startTime)/(24*60*60*1000)}var e=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"country",hiddenName:"country",listWidth:50,width:50});var g=new Ext.grid.GridPanel({title:'eBay Item Analyze (<font color="red">you want to specify multiple Seller, use a comma.</font>)',autoHeight:true,store:d,autoScroll:true,width:1300,selModel:new Ext.grid.RowSelectionModel({}),columns:[{header:"Image",width:100,align:"center",sortable:true,dataIndex:"galleryURL",renderer:h},{header:"Seller ID",width:80,align:"center",sortable:true,dataIndex:"userID"},{header:"Title",width:320,align:"center",sortable:true,dataIndex:"title"},{header:"Buy It Now",width:70,align:"center",sortable:true,dataIndex:"buyItNowAvailable"},{header:"Price",width:55,align:"center",sortable:true,dataIndex:"currentPrice"},{header:"Shipping Cost",width:100,align:"center",sortable:true,dataIndex:"shippingServiceCost",renderer:c},{header:"Listing Q",width:60,align:"center",sortable:true,dataIndex:"quantity"},{header:"Sold Q",width:60,align:"center",sortable:true,dataIndex:"quantitySold"},{header:"Start Time",width:130,align:"center",sortable:true,dataIndex:"startTime"},{header:"End Time",width:130,align:"center",sortable:true,dataIndex:"endTime"},{header:"Listing Days",width:80,align:"center",sortable:true,dataIndex:"startTime",renderer:f},{header:"Type",width:60,align:"center",sortable:true,dataIndex:"listingType"},{header:"Status",width:60,align:"center",sortable:true,dataIndex:"listingStatus"}],tbar:[{xtype:"tbtext",text:"Country:"},e,{xtype:"tbtext",text:"Store Name:"},{id:"storeName",name:"storeName",xtype:"textfield",width:120,listeners:{change:function(i,l,k){if(l.length>0){Ext.getCmp("seller").disable()}else{Ext.getCmp("seller").enable()}}}},"-",{xtype:"tbtext",text:"Seller:"},{id:"seller",name:"seller",xtype:"textfield",stateful:true,width:200},{text:"Select",handler:function(){var n=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var l=a.get("sellerArray");for(var m in l){if(Ext.type(l[m])=="string"){var o=new Ext.form.Checkbox({fieldLabel:(m==0)?"Seller":"",labelSeparator:(m==0)?":":"",boxLabel:l[m],name:l[m]});n.add(o)}}var k=new Ext.Window({autoScroll:true,title:"Select Seller",buttonAlign:"center",width:400,height:500,items:n,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var q="";for(var p in n.items.items){if(!Ext.isEmpty(n.items.items[p].name)){if(n.items.items[p].checked==true){q=q+n.items.items[p].name+","}}}q=q.substr(0,q.length-1);Ext.getCmp("seller").setValue(q);k.close()}},{text:"Add Seller",handler:function(){var p=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Seller",name:"seller"}]});var i=new Ext.Window({title:"Add Seller",width:300,height:100,items:p,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var q=p.getForm().findField("seller").getValue();var s=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:q,name:q});n.add(s);var r=a.get("sellerArray");if(Ext.isEmpty(r)){r=new Array();r.push(q);a.set("sellerArray",r)}else{r.push(q);a.set("sellerArray",r)}k.doLayout();i.close()}},{text:"Close",handler:function(){i.close()}}]});i.show()}},{text:"Delete Selected",handler:function(){for(var r in n.items.items){if(!Ext.isEmpty(n.items.items[r].name)){if(n.items.items[r].checked==true){var p=a.get("sellerArray");for(var q in p){console.log([n.items.items[r].name,p[q]]);if(n.items.items[r].name==p[q]){p[q]=p[0];p.shift();n.items.items[r].destroy()}}}}}console.log(p);a.set("sellerArray",p);n.doLayout();k.doLayout()}},{text:"Close",handler:function(){k.close()}}]});k.show()}},"-",{xtype:"tbtext",text:"Keyword:"},{id:"keyword",name:"keyword",xtype:"textfield",width:150},{text:"Select",handler:function(){var m=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var k=a.get("keywordArray");for(var l in k){if(Ext.type(k[l])=="string"){var o=new Ext.form.Checkbox({fieldLabel:(l==0)?"KeyWord":"",labelSeparator:(l==0)?":":"",boxLabel:k[l],name:k[l]});m.add(o)}}var n=new Ext.Window({autoScroll:true,title:"Select Keyword",buttonAlign:"center",width:400,height:500,items:m,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var q="";for(var p in m.items.items){if(!Ext.isEmpty(m.items.items[p].name)){if(m.items.items[p].checked==true){q=q+m.items.items[p].name+"%20"}}}q=q.substr(0,q.length-3);Ext.getCmp("keyword").setValue(q);n.close()}},{text:"Add Keyword",handler:function(){var p=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Keyword",name:"keyword"}]});var i=new Ext.Window({title:"Add Keyword",width:300,height:100,items:p,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var q=p.getForm().findField("keyword").getValue();var s=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:q,name:q});m.add(s);var r=a.get("keywordArray");if(Ext.isEmpty(r)){r=new Array();r.push(q);a.set("keywordArray",r)}else{r.push(q);a.set("keywordArray",r)}n.doLayout();i.close()}},{text:"Close",handler:function(){i.close()}}]});i.show()}},{text:"Delete Selected",handler:function(){for(var r in m.items.items){if(!Ext.isEmpty(m.items.items[r].name)){if(m.items.items[r].checked==true){var q=a.get("keywordArray");for(var p in q){console.log([m.items.items[r].name,q[p]]);if(m.items.items[r].name==q[p]){q[p]=q[0];q.shift();m.items.items[r].destroy()}}}}}console.log(q);a.set("keywordArray",q);m.doLayout();n.doLayout()}},{text:"Close",handler:function(){n.close()}}]});n.show()}},"-",{xtype:"tbtext",text:"End date from:"},{id:"from",name:"from",xtype:"datefield",format:"Y-m-d"},"-",{xtype:"tbtext",text:"End date to:"},{id:"to",name:"to",xtype:"datefield",format:"Y-m-d"},{text:"Submit",handler:function(){function l(s){var t=0;var p=new Array();var v=0;var u=function(A){var z=new Array();z[0]=A.item.itemID;z[1]=A.item.seller.userID;z[2]=A.item.title;z[3]=A.item.buyItNowAvailable;z[4]=A.item.currentPrice.currencyID+A.item.currentPrice.value;z[5]=A.item.shippingCostSummary.shippingServiceCost.currencyID+A.item.shippingCostSummary.shippingServiceCost.value;z[6]=A.item.quantity;z[7]=A.item.quantitySold;z[8]=A.item.galleryURL;z[9]=A.item.startTime;z[10]=A.item.endTime;z[11]=A.item.listingType.value;z[12]=A.item.listingStatus.value;p.push(z);t++;if(t==v){d.loadData(p)}};var y=function(z){Ext.Msg.alert("Warn",z.longMessage)};if(Ext.isArray(s.searchResult[0].itemArray.item)){v=s.searchResult[0].itemArray.item.length;for(j in s.searchResult[0].itemArray.item){if(!Ext.isEmpty(s.searchResult[0].itemArray.item[j].itemID)){var q=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var w=new com.ebay.shoppingservice.Shopping(q);var r=new com.ebay.shoppingservice.GetSingleItemRequestType({ItemID:s.searchResult[0].itemArray.item[j].itemID,IncludeSelector:"Details,ShippingCosts"});var x=new com.ebay.shoppingservice.ShoppingCallback({success:u,failure:y});w.getSingleItem(r,x)}}}else{}}function i(p){Ext.Msg.alert(p[0].severityCode.value,p[0].longMessage)}var k=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var n=new com.ebay.shoppingservice.Shopping(k);var m=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({ItemsLocatedIn:e.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:10,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var o=new com.ebay.shoppingservice.ShoppingCallback({success:l,failure:i});n.findItemsAdvanced(m,o)}}]});g.render("analyze-grid")}})});