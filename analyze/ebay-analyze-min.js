Ext.onReady(function(){Ext.BLANK_IMAGE_URL="../../Ext/2.2/resources/images/default/s.gif";var a=new Ext.state.CookieProvider({path:"/eBayBO/analyze/",expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(a);com.ebay.widgets.needs({baseUrl:"http://w-1.ebay.com/js/607/min/",files:["FindItemsAdvanced.js","GetSingleItem.js"],resources:[].concat(com.ebay.shoppingservice.Shopping.getSingleItem,com.ebay.shoppingservice.Shopping.findItemsAdvanced),callback:function(){var b=new Ext.data.ArrayReader({},[{name:"itemID"},{name:"userID"},{name:"title"},{name:"buyItNowAvailable"},{name:"currentPrice"},{name:"shippingServiceCost"},{name:"quantity"},{name:"quantitySold"},{name:"galleryURL"},{name:"startTime"},{name:"endTime",type:"date",dateFormat:"y-m-d H:i:s"},{name:"listingType"},{name:"listingStatus"}]);var d=new Ext.data.Store({reader:b});function g(h,k,i){return String.format('<img src="{0}"/>',h)}function c(h,k,i){if(h.substr(3)=="0"||h.substr(3)==0){return String.format('<font color="red">{0}</font>',h)}else{return String.format('<font color="green">{0}</font>',h)}}function e(h,k,i){return i.data.endTime.getElapsed(i.data.startTime)/(24*60*60*1000)}var f=new Ext.grid.GridPanel({title:'eBay Item Analyze (<font color="red">you want to specify multiple Seller, use a comma.</font>)',autoHeight:true,store:d,autoScroll:true,selModel:new Ext.grid.RowSelectionModel({}),columns:[{header:"Image",width:100,align:"center",sortable:true,dataIndex:"galleryURL",renderer:g},{header:"Seller ID",width:80,align:"center",sortable:true,dataIndex:"userID"},{header:"Title",width:320,align:"center",sortable:true,dataIndex:"title"},{header:"Buy It Now",width:70,align:"center",sortable:true,dataIndex:"buyItNowAvailable"},{header:"Price",width:55,align:"center",sortable:true,dataIndex:"currentPrice"},{header:"Shipping Cost",width:100,align:"center",sortable:true,dataIndex:"shippingServiceCost",renderer:c},{header:"Listing Q",width:60,align:"center",sortable:true,dataIndex:"quantity"},{header:"Sold Q",width:60,align:"center",sortable:true,dataIndex:"quantitySold"},{header:"Start Time",width:130,align:"center",sortable:true,dataIndex:"startTime"},{header:"End Time",width:130,align:"center",sortable:true,dataIndex:"endTime"},{header:"Listing Days",width:80,align:"center",sortable:true,dataIndex:"startTime",renderer:e},{header:"Type",width:60,align:"center",sortable:true,dataIndex:"listingType"},{header:"Status",width:60,align:"center",sortable:true,dataIndex:"listingStatus"}],tbar:[{xtype:"tbtext",text:"Store Name:"},{id:"storeName",name:"storeName",xtype:"textfield",width:120,listeners:{change:function(h,k,i){if(k.length>0){Ext.getCmp("seller").disable()}else{Ext.getCmp("seller").enable()}}}},"-",{xtype:"tbtext",text:"Seller:"},{id:"seller",name:"seller",xtype:"textfield",stateful:true,width:300},{text:"Select",handler:function(){var m=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var k=a.get("sellerArray");for(var l in k){if(Ext.type(k[l])=="string"){var n=new Ext.form.Checkbox({fieldLabel:(l==0)?"Seller":"",labelSeparator:(l==0)?":":"",boxLabel:k[l],name:k[l]});m.add(n)}}var h=new Ext.Window({autoScroll:true,title:"Select Seller",buttonAlign:"center",width:400,height:500,items:m,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var p="";for(var o in m.items.items){if(!Ext.isEmpty(m.items.items[o].name)){if(m.items.items[o].checked==true){p=p+m.items.items[o].name+","}}}p=p.substr(0,p.length-1);Ext.getCmp("seller").setValue(p);h.close()}},{text:"Add Seller",handler:function(){var o=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Seller",name:"seller"}]});var i=new Ext.Window({title:"Add Seller",width:300,height:100,items:o,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var p=o.getForm().findField("seller").getValue();var r=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:p,name:p});m.add(r);var q=a.get("sellerArray");if(Ext.isEmpty(q)){q=new Array();q.push(p);a.set("sellerArray",q)}else{q.push(p);a.set("sellerArray",q)}h.doLayout();i.close()}},{text:"Close",handler:function(){i.close()}}]});i.show()}},{text:"Delete Selected",handler:function(){for(var q in m.items.items){if(!Ext.isEmpty(m.items.items[q].name)){if(m.items.items[q].checked==true){var o=a.get("sellerArray");for(var p in o){console.log([m.items.items[q].name,o[p]]);if(m.items.items[q].name==o[p]){o[p]=o[0];o.shift();m.items.items[q].destroy()}}}}}console.log(o);a.set("sellerArray",o);m.doLayout();h.doLayout()}},{text:"Close",handler:function(){h.close()}}]});h.show()}},"-",{xtype:"tbtext",text:"Keyword:"},{id:"keyword",name:"keyword",xtype:"textfield",width:150},{text:"Select",handler:function(){var l=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var h=a.get("keywordArray");for(var k in h){if(Ext.type(h[k])=="string"){var n=new Ext.form.Checkbox({fieldLabel:(k==0)?"KeyWord":"",labelSeparator:(k==0)?":":"",boxLabel:h[k],name:h[k]});l.add(n)}}var m=new Ext.Window({autoScroll:true,title:"Select Keyword",buttonAlign:"center",width:400,height:500,items:l,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var p="";for(var o in l.items.items){if(!Ext.isEmpty(l.items.items[o].name)){if(l.items.items[o].checked==true){p=p+l.items.items[o].name+"%20"}}}p=p.substr(0,p.length-3);Ext.getCmp("keyword").setValue(p);m.close()}},{text:"Add Keyword",handler:function(){var o=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Keyword",name:"keyword"}]});var i=new Ext.Window({title:"Add Keyword",width:300,height:100,items:o,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var p=o.getForm().findField("keyword").getValue();var r=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:p,name:p});l.add(r);var q=a.get("keywordArray");if(Ext.isEmpty(q)){q=new Array();q.push(p);a.set("keywordArray",q)}else{q.push(p);a.set("keywordArray",q)}m.doLayout();i.close()}},{text:"Close",handler:function(){i.close()}}]});i.show()}},{text:"Delete Selected",handler:function(){for(var q in l.items.items){if(!Ext.isEmpty(l.items.items[q].name)){if(l.items.items[q].checked==true){var p=a.get("keywordArray");for(var o in p){console.log([l.items.items[q].name,p[o]]);if(l.items.items[q].name==p[o]){p[o]=p[0];p.shift();l.items.items[q].destroy()}}}}}console.log(p);a.set("keywordArray",p);l.doLayout();m.doLayout()}},{text:"Close",handler:function(){m.close()}}]});m.show()}},"-",{xtype:"tbtext",text:"End date from:"},{id:"from",name:"from",xtype:"datefield",format:"Y-m-d"},"-",{xtype:"tbtext",text:"End date to:"},{id:"to",name:"to",xtype:"datefield",format:"Y-m-d"},{text:"Submit",handler:function(){function k(r){var s=0;var o=new Array();var u=0;var t=function(z){var y=new Array();y[0]=z.item.itemID;y[1]=z.item.seller.userID;y[2]=z.item.title;y[3]=z.item.buyItNowAvailable;y[4]=z.item.currentPrice.currencyID+z.item.currentPrice.value;y[5]=z.item.shippingCostSummary.shippingServiceCost.currencyID+z.item.shippingCostSummary.shippingServiceCost.value;y[6]=z.item.quantity;y[7]=z.item.quantitySold;y[8]=z.item.galleryURL;y[9]=z.item.startTime;y[10]=z.item.endTime;y[11]=z.item.listingType.value;y[12]=z.item.listingStatus.value;o.push(y);s++;if(s==u){d.loadData(o)}};var x=function(y){Ext.Msg.alert("Warn",y.longMessage)};if(Ext.isArray(r.searchResult[0].itemArray.item)){u=r.searchResult[0].itemArray.item.length;for(j in r.searchResult[0].itemArray.item){if(!Ext.isEmpty(r.searchResult[0].itemArray.item[j].itemID)){var p=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var v=new com.ebay.shoppingservice.Shopping(p);var q=new com.ebay.shoppingservice.GetSingleItemRequestType({ItemID:r.searchResult[0].itemArray.item[j].itemID,IncludeSelector:"Details,ShippingCosts"});var w=new com.ebay.shoppingservice.ShoppingCallback({success:t,failure:x});v.getSingleItem(q,w)}}}else{}}function h(o){Ext.Msg.alert(o[0].severityCode.value,o[0].longMessage)}var i=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var m=new com.ebay.shoppingservice.Shopping(i);var l=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:10,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var n=new com.ebay.shoppingservice.ShoppingCallback({success:k,failure:h});m.findItemsAdvanced(l,n)}}]});f.render(document.body)}})});