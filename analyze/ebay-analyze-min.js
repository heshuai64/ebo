Ext.onReady(function(){Ext.BLANK_IMAGE_URL="../../Ext/2.2/resources/images/default/s.gif";var b=new Ext.state.CookieProvider({path:"/eBayBO/analyze/",expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(b);var a=new Ext.LoadMask(Ext.getBody(),{msg:"Please wait..."});com.ebay.widgets.needs({baseUrl:"http://w-1.ebay.com/js/607/min/",files:["FindItemsAdvanced.js","GetSingleItem.js"],resources:[].concat(com.ebay.shoppingservice.Shopping.getSingleItem,com.ebay.shoppingservice.Shopping.findItemsAdvanced),callback:function(){var c=new Ext.data.ArrayReader({},[{name:"itemID"},{name:"userID"},{name:"title"},{name:"buyItNowAvailable"},{name:"currentPrice"},{name:"shippingServiceCost"},{name:"quantity"},{name:"quantitySold"},{name:"galleryURL"},{name:"startTime"},{name:"endTime",type:"date",dateFormat:"y-m-d H:i:s"},{name:"listingType"},{name:"listingStatus"}]);var e=new Ext.data.Store({reader:c});function i(k,m,l){return String.format('<img src="{0}"/>',k)}function d(k,m,l){if(k.substr(3)=="0"||k.substr(3)==0){return String.format('<font color="red">{0}</font>',k)}else{return String.format('<font color="green">{0}</font>',k)}}function g(k,m,l){return l.data.endTime.getElapsed(l.data.startTime)/(24*60*60*1000)}var f=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"country",hiddenName:"country",listWidth:50,width:50});var h=new Ext.grid.GridPanel({title:'eBay Item Analyze (<font color="red">you want to specify multiple Seller, use a comma.</font>)',autoHeight:true,store:e,autoScroll:true,width:1300,selModel:new Ext.grid.RowSelectionModel({}),columns:[{header:"Image",width:100,align:"center",sortable:true,dataIndex:"galleryURL",renderer:i},{header:"Seller ID",width:80,align:"center",sortable:true,dataIndex:"userID"},{header:"Title",width:320,align:"center",sortable:true,dataIndex:"title"},{header:"Buy It Now",width:70,align:"center",sortable:true,dataIndex:"buyItNowAvailable"},{header:"Price",width:55,align:"center",sortable:true,dataIndex:"currentPrice"},{header:"Shipping Cost",width:100,align:"center",sortable:true,dataIndex:"shippingServiceCost",renderer:d},{header:"Listing Q",width:60,align:"center",sortable:true,dataIndex:"quantity"},{header:"Sold Q",width:60,align:"center",sortable:true,dataIndex:"quantitySold"},{header:"Start Time",width:130,align:"center",sortable:true,dataIndex:"startTime"},{header:"End Time",width:130,align:"center",sortable:true,dataIndex:"endTime"},{header:"Listing Days",width:80,align:"center",sortable:true,dataIndex:"startTime",renderer:g},{header:"Type",width:60,align:"center",sortable:true,dataIndex:"listingType"},{header:"Status",width:60,align:"center",sortable:true,dataIndex:"listingStatus"}],tbar:[{xtype:"tbtext",text:"Country:"},f,{xtype:"tbtext",text:"Store Name:"},{id:"storeName",name:"storeName",xtype:"textfield",width:120,listeners:{change:function(k,m,l){if(m.length>0){Ext.getCmp("seller").disable()}else{Ext.getCmp("seller").enable()}}}},"-",{xtype:"tbtext",text:"Seller:"},{id:"seller",name:"seller",xtype:"textfield",stateful:true,width:200},{text:"Select",handler:function(){var n=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var l=b.get("sellerArray");for(var m in l){if(Ext.type(l[m])=="string"){var o=new Ext.form.Checkbox({fieldLabel:(m==0)?"Seller":"",labelSeparator:(m==0)?":":"",boxLabel:l[m],name:l[m]});n.add(o)}}var k=new Ext.Window({autoScroll:true,title:"Select Seller",buttonAlign:"center",width:400,height:500,items:n,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var q="";for(var p in n.items.items){if(!Ext.isEmpty(n.items.items[p].name)){if(n.items.items[p].checked==true){q=q+n.items.items[p].name+","}}}q=q.substr(0,q.length-1);Ext.getCmp("seller").setValue(q);k.close()}},{text:"Add Seller",handler:function(){var q=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Seller",name:"seller"}]});var p=new Ext.Window({title:"Add Seller",width:300,height:100,items:q,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var r=q.getForm().findField("seller").getValue();var t=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:r,name:r});n.add(t);var s=b.get("sellerArray");if(Ext.isEmpty(s)){s=new Array();s.push(r);b.set("sellerArray",s)}else{s.push(r);b.set("sellerArray",s)}k.doLayout();p.close()}},{text:"Close",handler:function(){p.close()}}]});p.show()}},{text:"Delete Selected",handler:function(){for(var r in n.items.items){if(!Ext.isEmpty(n.items.items[r].name)){if(n.items.items[r].checked==true){var p=b.get("sellerArray");for(var q in p){console.log([n.items.items[r].name,p[q]]);if(n.items.items[r].name==p[q]){p[q]=p[0];p.shift();n.items.items[r].destroy()}}}}}console.log(p);b.set("sellerArray",p);n.doLayout();k.doLayout()}},{text:"Close",handler:function(){k.close()}}]});k.show()}},"-",{xtype:"tbtext",text:"Keyword:"},{id:"keyword",name:"keyword",xtype:"textfield",width:150},{text:"Select",handler:function(){var m=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var k=b.get("keywordArray");for(var l in k){if(Ext.type(k[l])=="string"){var o=new Ext.form.Checkbox({fieldLabel:(l==0)?"KeyWord":"",labelSeparator:(l==0)?":":"",boxLabel:k[l],name:k[l]});m.add(o)}}var n=new Ext.Window({autoScroll:true,title:"Select Keyword",buttonAlign:"center",width:400,height:500,items:m,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var q="";for(var p in m.items.items){if(!Ext.isEmpty(m.items.items[p].name)){if(m.items.items[p].checked==true){q=q+m.items.items[p].name+"%20"}}}q=q.substr(0,q.length-3);Ext.getCmp("keyword").setValue(q);n.close()}},{text:"Add Keyword",handler:function(){var q=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Keyword",name:"keyword"}]});var p=new Ext.Window({title:"Add Keyword",width:300,height:100,items:q,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var r=q.getForm().findField("keyword").getValue();var t=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:r,name:r});m.add(t);var s=b.get("keywordArray");if(Ext.isEmpty(s)){s=new Array();s.push(r);b.set("keywordArray",s)}else{s.push(r);b.set("keywordArray",s)}n.doLayout();p.close()}},{text:"Close",handler:function(){p.close()}}]});p.show()}},{text:"Delete Selected",handler:function(){for(var r in m.items.items){if(!Ext.isEmpty(m.items.items[r].name)){if(m.items.items[r].checked==true){var q=b.get("keywordArray");for(var p in q){console.log([m.items.items[r].name,q[p]]);if(m.items.items[r].name==q[p]){q[p]=q[0];q.shift();m.items.items[r].destroy()}}}}}console.log(q);b.set("keywordArray",q);m.doLayout();n.doLayout()}},{text:"Close",handler:function(){n.close()}}]});n.show()}},"-",{xtype:"tbtext",text:"End date from:"},{id:"from",name:"from",xtype:"datefield",format:"Y-m-d"},"-",{xtype:"tbtext",text:"End date to:"},{id:"to",name:"to",xtype:"datefield",format:"Y-m-d"},{text:"Submit",handler:function(){function n(u){var v=0;var r=new Array();var x=0;var w=function(C){var B=new Array();B[0]=C.item.itemID;B[1]=C.item.seller.userID;B[2]=C.item.title;B[3]=C.item.buyItNowAvailable;B[4]=C.item.currentPrice.currencyID+C.item.currentPrice.value;B[5]=C.item.shippingCostSummary.shippingServiceCost.currencyID+C.item.shippingCostSummary.shippingServiceCost.value;B[6]=C.item.quantity;B[7]=C.item.quantitySold;B[8]=C.item.galleryURL;B[9]=C.item.startTime;B[10]=C.item.endTime;B[11]=C.item.listingType.value;B[12]=C.item.listingStatus.value;r.push(B);v++;if(v==x){e.loadData(r);a.hide()}};var A=function(B){a.hide();Ext.Msg.alert("Warn",B.longMessage)};if(!Ext.isEmpty(u.searchResult)&&Ext.isArray(u.searchResult[0].itemArray.item)){x=u.searchResult[0].itemArray.item.length;a.show();for(j in u.searchResult[0].itemArray.item){if(!Ext.isEmpty(u.searchResult[0].itemArray.item[j].itemID)){var s=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var y=new com.ebay.shoppingservice.Shopping(s);var t=new com.ebay.shoppingservice.GetSingleItemRequestType({ItemID:u.searchResult[0].itemArray.item[j].itemID,IncludeSelector:"Details,ShippingCosts"});var z=new com.ebay.shoppingservice.ShoppingCallback({success:w,failure:A});y.getSingleItem(t,z)}}}else{Ext.Msg.alert("Warn","No Result!");e.removeAll()}}function l(r){a.hide();Ext.Msg.alert(r[0].severityCode.value,r[0].longMessage)}var m=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var p=new com.ebay.shoppingservice.Shopping(m);switch(f.getValue()){case"US":var k="USD";break;case"GB":var k="GBP";break;case"AU":var k="AUD";break;case"FR":var k="EUR";break}var o=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({Currency:k,ItemsAvailableTo:f.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:10,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var q=new com.ebay.shoppingservice.ShoppingCallback({success:n,failure:l});p.findItemsAdvanced(o,q)}}]});h.render("analyze-grid")}})});