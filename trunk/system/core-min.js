Ext.app.App=function(a){Ext.apply(this,a);this.addEvents({ready:true,beforeunload:true});Ext.onReady(this.initApp,this);};Ext.extend(Ext.app.App,Ext.util.Observable,{isReady:false,launchers:null,modules:null,styles:null,startConfig:null,startItemsConfig:null,logoutButtonConfig:null,connection:"connect.php",loader:"load.php",requestQueue:[],init:Ext.emptyFn,startMenuSortFn:Ext.emptyFn,getModules:Ext.emptyFn,getLaunchers:Ext.emptyFn,getStyles:Ext.emtpyFn,getStartConfig:Ext.emptyFn,getLogoutConfig:Ext.emptyFn,initApp:function(){Ext.BLANK_IMAGE_URL="resources/images/default/s.gif";this.preventBackspace();this.privileges=this.privileges||this.getPrivileges();this.modules=this.modules||this.getModules();this.initModules();this.startConfig=this.startConfig||this.getStartConfig();this.startItemsConfig=this.startItemsConfig||this.getStartItemsConfig();Ext.apply(this.startConfig,this.startItemsConfig);this.desktop=new Ext.Desktop(this);this.styles=this.styles||this.getStyles();this.initStyles();this.launchers=this.launchers||this.getLaunchers();this.initLaunchers();this.logoutConfig=this.logoutConfig||this.getLogoutConfig();this.initLogout();this.init();Ext.EventManager.on(window,"beforeunload",this.onBeforeUnload,this);this.fireEvent("ready",this);this.isReady=true;},initLogout:function(){if(this.logoutConfig){this.desktop.taskbar.startMenu.addTool(this.logoutConfig);}},initStyles:function(){var a=this.styles;if(!a){return false;}this.desktop.setBackgroundColor(a.backgroundcolor);this.desktop.setFontColor(a.fontcolor);this.desktop.setTheme(a.theme);this.desktop.setTransparency(a.transparency);this.desktop.setWallpaper(a.wallpaper);this.desktop.setWallpaperPosition(a.wallpaperposition);return true;},initModules:function(){var b=this.modules;if(!b){return false;}for(var c=0,a=b.length;c<a;c++){if(b[c].loaded===true){}else{b[c].launcher.handler=this.createWindow.createDelegate(this,[b[c].moduleId]);}b[c].app=this;}return true;},initLaunchers:function(){var a=this.launchers;if(!a){return false;}if(a.contextmenu){this.initContextMenu(a.contextmenu);}if(a.quickstart){this.initQuickStart(a.quickstart);}if(a.shortcut){this.initShortcut(a.shortcut);}if(a.autorun){this.onReady(this.initAutoRun.createDelegate(this,[a.autorun]),this);}return true;},initAutoRun:function(d){if(d){for(var c=0,b=d.length;c<b;c++){var a=this.getModule(d[c]);if(a){a.autorun=true;this.createWindow(d[c]);}}}},initContextMenu:function(c){if(c){for(var b=0,a=c.length;b<a;b++){this.desktop.addContextMenuItem(c[b]);}}},initShortcut:function(c){if(c){for(var b=0,a=c.length;b<a;b++){this.desktop.addShortcut(c[b],false);}}},initQuickStart:function(c){if(c){for(var b=0,a=c.length;b<a;b++){this.desktop.addQuickStartButton(c[b],false);}}},getStartItemsConfig:function(){var a=this.modules;var k=this.startMenuSortFn;if(a){var m;var j;var d={menu:{items:[]}};var g=d.menu.items;g.push({text:"StartMenu",menu:{items:[]}});g.push({text:"ToolMenu",menu:{items:[]}});for(var f=0,c=a.length;f<c;f++){if(a[f].menuPath){m=a[f].menuPath.split("/");j=m[0];if(m.length>0){if(j==="StartMenu"){l(g[0].menu,m,a[f].launcher);e(g[0].menu);}else{if(j==="ToolMenu"){l(g[1].menu,m,a[f].launcher);e(g[1].menu);}}}}}return{items:g[0].menu.items,toolItems:g[1].menu.items};}return null;function l(r,s,t){var q;var o;for(var p=1,n=s.length;p<n;p++){o=b(r.items,s[p]);if(!o){q={iconCls:"ux-start-menu-submenu",handler:function(){return false;},menu:{items:[]},text:s[p]};r.items.push(q);r=q.menu;}else{r=o;}}r.items.push(t);}function b(o,p){for(var n=0,i=o.length;n<i;n++){if(o[n].text===p){return o[n].menu;}}return null;}function e(q){var n=q.items;for(var p=0,o=n.length;p<o;p++){if(n[p].menu){e(n[p].menu);}h(n,0,n.length);}}function h(n,s,q){for(var p=q-1;p>=s;p--){for(var o=s;o<=p;o++){if(n[o+1]&&n[o]){if(k(n[o],n[o+1])){var r=n[o];n[o]=n[o+1];n[o+1]=r;}}}}return n;}},createWindow:function(b){var a=this.requestModule(b,function(c){if(c){c.createWindow();}},this);},requestModule:function(c,b,d){var a=this.getModule(c);if(a){if(a.loaded===true){b.call(d,a);}else{if(b&&d){this.requestQueue.push({moduleId:a.moduleId,callback:b,scope:d});this.loadModule(a.moduleId,a.launcher.text);}}}},loadModule:function(moduleId,moduleName){var notifyWin=this.desktop.showNotification({html:"Loading "+moduleName+"...",title:"Please wait"});Ext.Ajax.request({url:this.loader,params:{moduleId:moduleId},success:function(o){notifyWin.setIconClass("x-icon-done");notifyWin.setTitle("Finished");notifyWin.setMessage(moduleName+" loaded.");this.desktop.hideNotification(notifyWin);notifyWin=null;if(o.responseText!==""){eval(o.responseText);this.loadModuleComplete(true,moduleId);}else{alert("An error occured on the server.");}},failure:function(){alert("Connection to the server failed!");},scope:this});},loadModuleComplete:function(g,d){if(g===true&&d){var b=this.getModule(d);b.loaded=true;b.init();var f=this.requestQueue;var e=[];for(var c=0,a=f.length;c<a;c++){if(f[c].moduleId===d){f[c].callback.call(f[c].scope,b);}else{e.push(f[c]);}}this.requestQueue=e;}},getModule:function(b){var c=this.modules;for(var d=0,a=c.length;d<a;d++){if(c[d].moduleId==b||c[d].moduleType==b){return c[d];}}return null;},registerModule:function(a){if(!a){return false;}this.modules.push(a);a.launcher.handler=this.createWindow.createDelegate(this,[a.moduleId]);a.app=this;},makeRequest:function(b,c){if(b!==""&&Ext.isArray(c)){var a=this.requestModule(b,function(d){if(d){d.handleRequest(c);}},this);}},isAllowedTo:function(f,e){var g=this.privileges,c=g[f];if(g&&c){for(var d=0,b=c.length;d<b;d++){if(c[d]===e){return true;}}}return false;},getDesktop:function(){return this.desktop;},onReady:function(b,a){if(!this.isReady){this.on("ready",b,a);}else{b.call(a,this);}},onBeforeUnload:function(a){if(this.fireEvent("beforeunload",this)===false){a.stopEvent();}},preventBackspace:function(){var a=new Ext.KeyMap(document,[{key:Ext.EventObject.BACKSPACE,fn:function(c,d){var b=d.target.tagName;if(b!="INPUT"&&b!="TEXTAREA"){d.stopEvent();}}}]);}});Ext.Desktop=function(a){this.taskbar=new Ext.ux.TaskBar(a);var f=this.taskbar;this.el=Ext.get("x-desktop");var j=this.el;var c=Ext.get("ux-taskbar");this.shortcuts=new Ext.ux.Shortcuts({renderTo:"x-desktop",taskbarEl:c});var h=new Ext.WindowGroup();h.zseed=10000;var d;function e(l){l.minimized=true;l.hide();}function i(l){if(d&&d!=l){k(d);}f.setActiveButton(l.taskButton);d=l;Ext.fly(l.taskButton.el).addClass("active-win");l.minimized=false;}function k(l){if(l==d){d=null;Ext.fly(l.taskButton.el).removeClass("active-win");}}function b(l){f.taskButtonPanel.remove(l.taskButton);g();}function g(){j.setHeight(Ext.lib.Dom.getViewHeight()-c.getHeight());}Ext.EventManager.onWindowResize(g);this.layout=g;this.createWindow=function(m,l){var n=new (l||Ext.Window)(Ext.applyIf(m||{},{manager:h,minimizable:true,maximizable:true}));n.render(j);n.taskButton=f.taskButtonPanel.add(n);n.cmenu=new Ext.menu.Menu({items:[]});n.animateTarget=n.taskButton.el;n.on({activate:{fn:i},beforeshow:{fn:i},deactivate:{fn:k},minimize:{fn:e},close:{fn:b}});g();return n;};this.getManager=function(){return h;};this.getWindow=function(l){return h.get(l);};this.getViewHeight=function(){return(Ext.lib.Dom.getViewHeight()-c.getHeight());};this.getViewWidth=function(){return Ext.lib.Dom.getViewWidth();};this.getWinWidth=function(){var l=Ext.lib.Dom.getViewWidth();return l<200?200:l;};this.getWinHeight=function(){var l=(Ext.lib.Dom.getViewHeight()-c.getHeight());return l<100?100:l;};this.getWinX=function(l){return(Ext.lib.Dom.getViewWidth()-l)/2;};this.getWinY=function(l){return(Ext.lib.Dom.getViewHeight()-c.getHeight()-l)/2;};this.setBackgroundColor=function(l){if(l){Ext.get(document.body).setStyle("background-color","#"+l);a.styles.backgroundcolor=l;}};this.setFontColor=function(l){if(l){Ext.util.CSS.updateRule(".ux-shortcut-btn-text","color","#"+l);a.styles.fontcolor=l;}};this.setTheme=function(l){if(l&&l.id&&l.name&&l.pathtofile){Ext.util.CSS.swapStyleSheet("theme",l.pathtofile);a.styles.theme=l;}};this.setTransparency=function(l){if(l>=0&&l<=100){c.addClass("transparent");Ext.util.CSS.updateRule(".transparent","opacity",l/100);Ext.util.CSS.updateRule(".transparent","-moz-opacity",l/100);Ext.util.CSS.updateRule(".transparent","filter","alpha(opacity="+l+")");a.styles.transparency=l;}};this.setWallpaper=function(q){if(q&&q.id&&q.name&&q.pathtofile){var p=this.showNotification({html:"Loading wallpaper...",title:"Please wait"});var m=new Image();m.src=q.pathtofile;var l=new Ext.util.DelayedTask(n,this);l.delay(200);a.styles.wallpaper=q;}function n(){if(m.complete){l.cancel();p.setIconClass("x-icon-done");p.setTitle("Finished");p.setMessage("Wallpaper loaded.");this.hideNotification(p);document.body.background=m.src;}else{l.delay(200);}}};this.setWallpaperPosition=function(m){if(m){if(m==="center"){var l=Ext.get(document.body);l.removeClass("wallpaper-tile");l.addClass("wallpaper-center");}else{if(m==="tile"){var l=Ext.get(document.body);l.removeClass("wallpaper-center");l.addClass("wallpaper-tile");}}a.styles.wallpaperposition=m;}};this.showNotification=function(l){var m=new Ext.ux.Notification(Ext.apply({animateTarget:c,autoDestroy:true,hideDelay:5000,html:"",iconCls:"x-icon-waiting",title:""},l));m.show();return m;};this.hideNotification=function(m,l){if(m){(function(){m.animHide();}).defer(l||3000);}};this.addAutoRun=function(o){var l=a.getModule(o),n=a.launchers.autorun;if(l&&!l.autorun){l.autorun=true;n.push(o);}};this.removeAutoRun=function(p){var l=a.getModule(p),o=a.launchers.autorun;if(l&&l.autorun){var n=0;while(n<o.length){if(o[n]==p){o.splice(n,1);}else{n++;}}l.autorun=null;}};this.addContextMenuItem=function(n){var l=a.getModule(n);if(l&&!l.contextMenuItem){this.cmenu.add(l.launcher);}};this.addShortcut=function(p,n){var l=a.getModule(p);if(l&&!l.shortcut){var o=l.launcher;l.shortcut=this.shortcuts.addShortcut({handler:o.handler,iconCls:o.shortcutIconCls,scope:o.scope,text:o.text,tooltip:o.tooltip||""});if(n){a.launchers.shortcut.push(p);}}};this.removeShortcut=function(q,n){var l=a.getModule(q);if(l&&l.shortcut){this.shortcuts.removeShortcut(l.shortcut);l.shortcut=null;if(n){var p=a.launchers.shortcut,o=0;while(o<p.length){if(p[o]==q){p.splice(o,1);}else{o++;}}}}};this.addQuickStartButton=function(p,n){var l=a.getModule(p);if(l&&!l.quickStartButton){var o=l.launcher;l.quickStartButton=this.taskbar.quickStartPanel.add({handler:o.handler,iconCls:o.iconCls,scope:o.scope,text:o.text,tooltip:o.tooltip||o.text});if(n){a.launchers.quickstart.push(p);}}};this.removeQuickStartButton=function(q,o){var n=a.getModule(q);if(n&&n.quickStartButton){this.taskbar.quickStartPanel.remove(n.quickStartButton);n.quickStartButton=null;if(o){var l=a.launchers.quickstart,p=0;while(p<l.length){if(l[p]==q){l.splice(p,1);}else{p++;}}}}};g();this.cmenu=new Ext.menu.Menu();j.on("contextmenu",function(m){if(m.target.id===j.id){m.stopEvent();if(!this.cmenu.el){this.cmenu.render();}var l=m.getXY();l[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(l);}},this);};Ext.namespace("Ext.ux.form");Ext.ux.form.HexField=Ext.extend(Ext.form.TextField,{initEvents:function(){Ext.ux.form.HexField.superclass.initEvents.call(this);var a=function(i){var b=i.getKey();if(!Ext.isIE&&(i.isSpecialKey()||b==i.BACKSPACE||b==i.DELETE)){return;}var j="0123456789abcdefABCDEF";var g=new Ext.ux.form.HexField.Selection(document.getElementById(this.id));var f=g.create();var d=f.end-f.start;var l=i.getCharCode();var l=String.fromCharCode(l);var h=l+this.getValue();if(j.indexOf(l)===-1||(h.length>6&&d===0)){i.stopEvent();}};this.el.on("keypress",a,this);},validateValue:function(a){if(!Ext.ux.form.HexField.superclass.validateValue.call(this,a)){return false;}if(!/^[0-9a-fA-F]{6}$/.test(a)){return false;}return true;}});Ext.reg("hexfield",Ext.ux.form.HexField);Ext.ux.form.HexField.Selection=function(a){this.element=a;};Ext.ux.form.HexField.Selection.prototype.create=function(){if(document.selection!=null&&this.element.selectionStart==null){return this._ieGetSelection();}else{return this._mozillaGetSelection();}};Ext.ux.form.HexField.Selection.prototype._mozillaGetSelection=function(){return{start:this.element.selectionStart,end:this.element.selectionEnd};};Ext.ux.form.HexField.Selection.prototype._ieGetSelection=function(){this.element.focus();var d=document.selection.createRange();var f=d.getBookmark();var g=this.element.value;var c=g;var b=this._createSelectionMarker();while(g.indexOf(b)!=-1){b=this._createSelectionMarker();}var e=d.parentElement();if(e==null||e.type!="text"){return{start:0,end:0};}d.text=b+d.text+b;g=this.element.value;var a={};a.start=g.indexOf(b);g=g.replace(b,"");a.end=g.indexOf(b);this.element.value=c;d.moveToBookmark(f);d.select();return a;};Ext.ux.form.HexField.Selection.prototype._createSelectionMarker=function(){return"##SELECTION_MARKER_"+Math.random()+"##";};Ext.app.Module=function(a){Ext.apply(this,a);Ext.app.Module.superclass.constructor.call(this);};Ext.extend(Ext.app.Module,Ext.util.Observable,{launcher:null,loaded:false,menuPath:"StartMenu",moduleType:null,moduleId:null,init:Ext.emptyFn,createWindow:Ext.emptyFn,handleRequest:Ext.emptyFn});Ext.ux.NotificationMgr={positions:[]};Ext.ux.Notification=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{iconCls:this.iconCls||"x-icon-information",width:200,autoHeight:true,closable:true,plain:false,draggable:false,bodyStyle:"text-align:left;padding:10px;",resizable:false});if(this.autoDestroy){this.task=new Ext.util.DelayedTask(this.close,this);}else{this.closable=true;}Ext.ux.Notification.superclass.initComponent.call(this);},setMessage:function(a){this.body.update(a);},setTitle:function(b,a){Ext.ux.Notification.superclass.setTitle.call(this,b,a||this.iconCls);},onRender:function(b,a){Ext.ux.Notification.superclass.onRender.call(this,b,a);},onDestroy:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);Ext.ux.Notification.superclass.onDestroy.call(this);},afterShow:function(){Ext.ux.Notification.superclass.afterShow.call(this);this.on("move",function(){Ext.ux.NotificationMgr.positions.remove(this.pos);if(this.autoDestroy){this.task.cancel();}},this);if(this.autoDestroy){this.task.delay(this.hideDelay||5000);}},animShow:function(){this.pos=0;while(Ext.ux.NotificationMgr.positions.indexOf(this.pos)>-1){this.pos++;}Ext.ux.NotificationMgr.positions.push(this.pos);this.setSize(200,100);this.el.alignTo(this.animateTarget||document,"br-tr",[-1,-1-((this.getSize().height+10)*this.pos)]);this.el.slideIn("b",{duration:0.7,callback:this.afterShow,scope:this});},animHide:function(){Ext.ux.NotificationMgr.positions.remove(this.pos);this.el.ghost("b",{duration:1,remove:true});}});Ext.namespace("Ext.ux");Ext.ux.Shortcuts=function(a){var j=Ext.get(a.renderTo),d=a.taskbarEl,e=74,i=64,c=15,b=null,k=null,g=[];f();function f(){b={index:1,x:c};k={index:1,y:c};}function h(l){if(l>(Ext.lib.Dom.getViewHeight()-d.getHeight())){return true;}return false;}this.addShortcut=function(l){var n=j.createChild({tag:"div",cls:"ux-shortcut-item"}),m=new Ext.ux.ShortcutButton(Ext.apply(l,{text:Ext.util.Format.ellipsis(l.text,25)}),n);g.push(m);this.setXY(m.container);return m;};this.removeShortcut=function(m){var p=document.getElementById(m.container.id);m.destroy();p.parentNode.removeChild(p);var o=[];for(var n=0,l=g.length;n<l;n++){if(g[n]!=m){o.push(g[n]);}}g=o;this.handleUpdate();};this.handleUpdate=function(){f();for(var m=0,l=g.length;m<l;m++){this.setXY(g[m].container);}};this.setXY=function(m){var l=k.y+e,n=h(k.y+e);if(n&&l>(e+c)){b={index:b.index++,x:b.x+i+c};k={index:1,y:c};}m.setXY([b.x,k.y]);k.index++;k.y=k.y+e+c;};Ext.EventManager.onWindowResize(this.handleUpdate,this,{delay:500});};Ext.ux.ShortcutButton=function(a,b){Ext.ux.ShortcutButton.superclass.constructor.call(this,Ext.apply(a,{renderTo:b,template:new Ext.Template('<div class="ux-shortcut-btn"><div>','<img src="'+Ext.BLANK_IMAGE_URL+'" />','<div class="ux-shortcut-btn-text">{0}</div>',"</div></div>")}));};Ext.extend(Ext.ux.ShortcutButton,Ext.Button,{buttonSelector:"div:first",initButtonEl:function(a,b){Ext.ux.ShortcutButton.superclass.initButtonEl.apply(this,arguments);a.removeClass("x-btn");if(this.iconCls){if(!this.cls){a.removeClass(this.text?"x-btn-text-icon":"x-btn-icon");}}},autoWidth:function(){},setText:function(a){this.text=a;if(this.el){this.el.child("div.ux-shortcut-btn-text").update(a);}}});Ext.namespace("Ext.ux");Ext.ux.StartMenu=function(a){Ext.ux.StartMenu.superclass.constructor.call(this,a);var b=this.toolItems;this.toolItems=new Ext.util.MixedCollection();if(b){this.addTool.apply(this,b);}};Ext.extend(Ext.ux.StartMenu,Ext.menu.Menu,{height:300,toolPanelWidth:100,width:300,render:function(){if(this.el){return;}var a=this.el=new Ext.Layer({cls:"x-menu ux-start-menu",shadow:this.shadow,constrain:false,parentEl:this.parentEl||document.body,zindex:15000});var e=a.createChild({tag:"div"});e.setStyle("padding","7px 0 0 0");this.header=e;var n=e.wrap({cls:"ux-start-menu-tl"});var j=e.wrap({cls:"ux-start-menu-tr"});var c=e.wrap({cls:"ux-start-menu-tc"});this.menuBWrap=a.createChild({tag:"div",cls:"ux-start-menu-body x-border-layout-ct ux-start-menu-body"});var d=this.menuBWrap.wrap({cls:"ux-start-menu-ml"});var k=this.menuBWrap.wrap({cls:"ux-start-menu-mc ux-start-menu-bwrap"});this.menuPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-apps-panel opaque"});this.toolsPanel=this.menuBWrap.createChild({tag:"div",cls:"x-panel x-border-panel ux-start-menu-tools-panel"});var i=d.wrap({cls:"x-window-bwrap"});var h=i.createChild({tag:"div",cls:"ux-start-menu-bc"});var b=h.wrap({cls:"ux-start-menu-bl x-panel-nofooter"});var m=h.wrap({cls:"ux-start-menu-br"});h.setStyle({height:"0px",padding:"0 0 6px 0"});this.keyNav=new Ext.menu.MenuNav(this);if(this.plain){a.addClass("x-menu-plain");}if(this.cls){a.addClass(this.cls);}this.focusEl=a.createChild({tag:"a",cls:"x-menu-focus",href:"#",onclick:"return false;",tabIndex:"-1"});var g=this.menuPanel.createChild({tag:"ul",cls:"x-menu-list"});var l=this.toolsPanel.createChild({tag:"ul",cls:"x-menu-list"});var f={click:{fn:this.onClick,scope:this},mouseover:{fn:this.onMouseOver,scope:this},mouseout:{fn:this.onMouseOut,scope:this}};g.on(f);this.items.each(function(p){var o=document.createElement("li");o.className="x-menu-list-item";g.dom.appendChild(o);p.render(o,this);},this);this.ul=g;this.autoWidth();l.on(f);this.toolItems.each(function(p){var o=document.createElement("li");o.className="x-menu-list-item";l.dom.appendChild(o);p.render(o,this);},this);this.toolsUl=l;this.autoWidth();this.menuBWrap.setStyle("position","relative");this.menuBWrap.setHeight(this.height);this.menuPanel.setStyle({padding:"2px",position:"absolute",overflow:"auto"});this.toolsPanel.setStyle({padding:"2px 4px 2px 2px",position:"absolute",overflow:"auto"});this.setTitle(this.title);},findTargetItem:function(b){var a=b.getTarget(".x-menu-list-item",this.ul,true);if(a&&a.menuItemId){if(this.items.get(a.menuItemId)){return this.items.get(a.menuItemId);}else{return this.toolItems.get(a.menuItemId);}}},show:function(b,e,a){this.parentMenu=a;if(!this.el){this.render();}this.fireEvent("beforeshow",this);this.showAt(this.el.getAlignToXY(b,e||this.defaultAlign),a,false);var d=this.toolPanelWidth;var c=this.menuBWrap.getBox();this.menuPanel.setWidth(c.width-d);this.menuPanel.setHeight(c.height);this.toolsPanel.setWidth(d);this.toolsPanel.setX(c.x+c.width-d);this.toolsPanel.setHeight(c.height);},addTool:function(){var c=arguments,b=c.length,f;for(var d=0;d<b;d++){var e=c[d];if(e.render){f=this.addToolItem(e);}else{if(typeof e=="string"){if(e=="separator"||e=="-"){f=this.addToolSeparator();}else{f=this.addText(e);}}else{if(e.tagName||e.el){f=this.addElement(e);}else{if(typeof e=="object"){f=this.addToolMenuItem(e);}}}}}return f;},addToolSeparator:function(){return this.addToolItem(new Ext.menu.Separator({itemCls:"ux-toolmenu-sep"}));},addToolItem:function(b){this.toolItems.add(b);if(this.toolsUl){var a=document.createElement("li");a.className="x-menu-list-item";this.toolsUl.dom.appendChild(a);b.render(a,this);this.delayAutoWidth();}return b;},addToolMenuItem:function(a){if(!(a instanceof Ext.menu.Item)){if(typeof a.checked=="boolean"){a=new Ext.menu.CheckItem(a);}else{a=new Ext.menu.Item(a);}}return this.addToolItem(a);},setTitle:function(b,a){this.title=b;if(this.header.child("span")){this.header.child("span").update(b);}return this;},getToolButton:function(a){var b=new Ext.Button({handler:a.handler,minWidth:this.toolPanelWidth-10,scope:a.scope,text:a.text});return b;}});Ext.namespace("Ext.ux");Ext.ux.TaskBar=function(a){this.app=a;this.init();};Ext.extend(Ext.ux.TaskBar,Ext.util.Observable,{init:function(){this.startMenu=new Ext.ux.StartMenu(Ext.apply({iconCls:"user",height:300,shadow:true,title:"Todd Murdock",width:300},this.app.startConfig));this.startButton=new Ext.Button({text:"Start",id:"ux-startbutton",iconCls:"start",menu:this.startMenu,menuAlign:"bl-tl",renderTo:"ux-taskbar-start"});var a=Ext.get("ux-startbutton").getWidth()+10;var d=new Ext.BoxComponent({el:"ux-taskbar-start",id:"TaskBarStart",minWidth:a,region:"west",split:false,width:a});this.quickStartPanel=new Ext.ux.QuickStartPanel({el:"ux-quickstart-panel",id:"TaskBarQuickStart",minWidth:60,region:"west",split:true,width:94});this.taskButtonPanel=new Ext.ux.TaskButtonsPanel({el:"ux-taskbuttons-panel",id:"TaskBarButtons",region:"center"});var c=new Ext.Container({el:"ux-taskbar-panel-wrap",items:[this.quickStartPanel,this.taskButtonPanel],layout:"border",region:"center"});var b=new Ext.ux.TaskBarContainer({el:"ux-taskbar",layout:"border",items:[d,c]});this.el=b.el;return this;},setActiveButton:function(a){this.taskButtonPanel.setActiveButton(a);}});Ext.ux.TaskBarContainer=Ext.extend(Ext.Container,{initComponent:function(){Ext.ux.TaskBarContainer.superclass.initComponent.call(this);this.el=Ext.get(this.el)||Ext.getBody();this.el.setHeight=Ext.emptyFn;this.el.setWidth=Ext.emptyFn;this.el.setSize=Ext.emptyFn;this.el.setStyle({overflow:"hidden",margin:"0",border:"0 none"});this.el.dom.scroll="no";this.allowDomMove=false;this.autoWidth=true;this.autoHeight=true;Ext.EventManager.onWindowResize(this.fireResize,this);this.renderTo=this.el;},fireResize:function(a,b){this.fireEvent("resize",this,a,b,a,b);}});Ext.ux.TaskButtonsPanel=Ext.extend(Ext.BoxComponent,{activeButton:null,enableScroll:true,scrollIncrement:0,scrollRepeatInterval:400,scrollDuration:0.35,animScroll:true,resizeButtons:true,buttonWidth:168,minButtonWidth:118,buttonMargin:2,buttonWidthSet:false,initComponent:function(){Ext.ux.TaskButtonsPanel.superclass.initComponent.call(this);this.on("resize",this.delegateUpdates);this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:"ux-taskbuttons-strip-wrap",cn:{tag:"ul",cls:"ux-taskbuttons-strip"}});this.stripSpacer=Ext.get(this.el).createChild({cls:"ux-taskbuttons-strip-spacer"});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:"li",cls:"ux-taskbuttons-edge"});this.strip.createChild({cls:"x-clear"});},add:function(c){var a=this.strip.createChild({tag:"li"},this.edge);var b=new Ext.ux.TaskBar.TaskButton(c,a);this.items.push(b);if(!this.buttonWidthSet){this.lastButtonWidth=b.container.getWidth();}this.setActiveButton(b);return b;},remove:function(d){var b=document.getElementById(d.container.id);d.destroy();b.parentNode.removeChild(b);var e=[];for(var c=0,a=this.items.length;c<a;c++){if(this.items[c]!=d){e.push(this.items[c]);}}this.items=e;this.delegateUpdates();},setActiveButton:function(a){this.activeButton=a;this.delegateUpdates();},delegateUpdates:function(){if(this.resizeButtons&&this.rendered){this.autoSize();}if(this.enableScroll&&this.rendered){this.autoScroll();}},autoSize:function(){var h=this.items.length;var c=this.el.dom.offsetWidth;var a=this.el.dom.clientWidth;if(!this.resizeButtons||h<1||!a){return;}var k=Math.max(Math.min(Math.floor((a-4)/h)-this.buttonMargin,this.buttonWidth),this.minButtonWidth);var e=this.stripWrap.dom.getElementsByTagName("button");this.lastButtonWidth=Ext.get(e[0].id).findParent("li").offsetWidth;for(var f=0,j=e.length;f<j;f++){var b=e[f];var g=Ext.get(e[f].id).findParent("li").offsetWidth;var d=b.offsetWidth;b.style.width=(k-(g-d))+"px";}},autoScroll:function(){var f=this.items.length;var d=this.el.dom.offsetWidth;var c=this.el.dom.clientWidth;var e=this.stripWrap;var b=e.dom.offsetWidth;var g=this.getScrollPos();var a=this.edge.getOffsetsTo(this.stripWrap)[0]+g;if(!this.enableScroll||f<1||b<20){return;}e.setWidth(c);if(a<=c){e.dom.scrollLeft=0;if(this.scrolling){this.scrolling=false;this.el.removeClass("x-taskbuttons-scrolling");this.scrollLeft.hide();this.scrollRight.hide();}}else{if(!this.scrolling){this.el.addClass("x-taskbuttons-scrolling");}c-=e.getMargins("lr");e.setWidth(c>20?c:20);if(!this.scrolling){if(!this.scrollLeft){this.createScrollers();}else{this.scrollLeft.show();this.scrollRight.show();}}this.scrolling=true;if(g>(a-c)){e.dom.scrollLeft=a-c;}else{this.scrollToButton(this.activeButton,true);}this.updateScrollButtons();}},createScrollers:function(){var c=this.el.dom.offsetHeight;var a=this.el.insertFirst({cls:"ux-taskbuttons-scroller-left"});a.setHeight(c);a.addClassOnOver("ux-taskbuttons-scroller-left-over");this.leftRepeater=new Ext.util.ClickRepeater(a,{interval:this.scrollRepeatInterval,handler:this.onScrollLeft,scope:this});this.scrollLeft=a;var b=this.el.insertFirst({cls:"ux-taskbuttons-scroller-right"});b.setHeight(c);b.addClassOnOver("ux-taskbuttons-scroller-right-over");this.rightRepeater=new Ext.util.ClickRepeater(b,{interval:this.scrollRepeatInterval,handler:this.onScrollRight,scope:this});this.scrollRight=b;},getScrollWidth:function(){return this.edge.getOffsetsTo(this.stripWrap)[0]+this.getScrollPos();},getScrollPos:function(){return parseInt(this.stripWrap.dom.scrollLeft,10)||0;},getScrollArea:function(){return parseInt(this.stripWrap.dom.clientWidth,10)||0;},getScrollAnim:function(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this};},getScrollIncrement:function(){return(this.scrollIncrement||this.lastButtonWidth+2);},scrollToButton:function(e,a){e=e.el.dom.parentNode;if(!e){return;}var c=e;var g=this.getScrollPos(),d=this.getScrollArea();var f=Ext.fly(c).getOffsetsTo(this.stripWrap)[0]+g;var b=f+c.offsetWidth;if(f<g){this.scrollTo(f,a);}else{if(b>(g+d)){this.scrollTo(b-d,a);}}},scrollTo:function(b,a){this.stripWrap.scrollTo("left",b,a?this.getScrollAnim():false);if(!a){this.updateScrollButtons();}},onScrollRight:function(){var a=this.getScrollWidth()-this.getScrollArea();var c=this.getScrollPos();var b=Math.min(a,c+this.getScrollIncrement());if(b!=c){this.scrollTo(b,this.animScroll);}},onScrollLeft:function(){var b=this.getScrollPos();var a=Math.max(0,b-this.getScrollIncrement());if(a!=b){this.scrollTo(a,this.animScroll);}},updateScrollButtons:function(){var a=this.getScrollPos();this.scrollLeft[a==0?"addClass":"removeClass"]("ux-taskbuttons-scroller-left-disabled");this.scrollRight[a>=(this.getScrollWidth()-this.getScrollArea())?"addClass":"removeClass"]("ux-taskbuttons-scroller-right-disabled");}});Ext.ux.TaskBar.TaskButton=function(b,a){this.win=b;Ext.ux.TaskBar.TaskButton.superclass.constructor.call(this,{iconCls:b.iconCls,text:Ext.util.Format.ellipsis(b.title,20),tooltip:b.taskbuttonTooltip||b.title,renderTo:a,handler:function(){if(b.minimized||b.hidden){b.show();}else{if(b==b.manager.getActive()){b.minimize();}else{b.toFront();}}},clickEvent:"mousedown"});};Ext.extend(Ext.ux.TaskBar.TaskButton,Ext.Button,{onRender:function(){Ext.ux.TaskBar.TaskButton.superclass.onRender.apply(this,arguments);this.cmenu=new Ext.menu.Menu({items:[{id:"restore",text:"Restore",handler:function(){if(!this.win.isVisible()){this.win.show();}else{this.win.restore();}},scope:this},{id:"minimize",text:"Minimize",handler:this.win.minimize,scope:this.win},{id:"maximize",text:"Maximize",handler:this.win.maximize,scope:this.win},"-",{id:"close",text:"Close",handler:this.closeWin.createDelegate(this,this.win,true),scope:this.win}]});this.cmenu.on("beforeshow",function(){var b=this.cmenu.items.items;var a=this.win;b[0].setDisabled(a.maximized!==true&&a.hidden!==true);b[1].setDisabled(a.minimized===true);b[2].setDisabled(a.maximized===true||a.hidden===true);b[2].setDisabled(a.maximizable===false);b[3].setDisabled(a.closable===false);},this);this.el.on("contextmenu",function(b){b.stopEvent();if(!this.cmenu.el){this.cmenu.render();}var a=b.getXY();a[1]-=this.cmenu.el.getHeight();this.cmenu.showAt(a);},this);},closeWin:function(a,c,b){if(!b.isVisible()){b.show();}else{b.restore();}b.close();},setText:function(a){if(a){this.text=a;if(this.el){this.el.child("td.x-btn-center "+this.buttonSelector).update(Ext.util.Format.ellipsis(a,20));}}},setTooltip:function(b){if(b){this.tooltip=b;var a=this.el.child(this.buttonSelector);Ext.QuickTips.unregister(a.id);if(typeof this.tooltip=="object"){Ext.QuickTips.register(Ext.apply({target:a.id},this.tooltip));}else{a.dom[this.tooltipType]=this.tooltip;}}}});Ext.ux.QuickStartPanel=Ext.extend(Ext.BoxComponent,{enableMenu:true,initComponent:function(){Ext.ux.QuickStartPanel.superclass.initComponent.call(this);this.on("resize",this.delegateUpdates);this.menu=new Ext.menu.Menu();this.items=[];this.stripWrap=Ext.get(this.el).createChild({cls:"ux-quickstart-strip-wrap",cn:{tag:"ul",cls:"ux-quickstart-strip"}});this.stripSpacer=Ext.get(this.el).createChild({cls:"ux-quickstart-strip-spacer"});this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.edge=this.strip.createChild({tag:"li",cls:"ux-quickstart-edge"});this.strip.createChild({cls:"x-clear"});},add:function(b){var a=this.strip.createChild({tag:"li"},this.edge);var c=new Ext.Button(Ext.apply(b,{cls:"x-btn-icon",menuText:b.text,renderTo:a,text:""}));this.items.push(c);this.delegateUpdates();return c;},remove:function(d){var b=document.getElementById(d.container.id);d.destroy();b.parentNode.removeChild(b);var e=[];for(var c=0,a=this.items.length;c<a;c++){if(this.items[c]!=d){e.push(this.items[c]);}}this.items=e;this.delegateUpdates();},menuAdd:function(a){this.menu.add(a);},delegateUpdates:function(){if(this.enableMenu&&this.rendered){this.showButtons();this.clearMenu();this.autoMenu();}},showButtons:function(){var b=this.items.length;for(var a=0;a<b;a++){this.items[a].show();}},clearMenu:function(){this.menu.removeAll();},autoMenu:function(){var k=this.items.length;var e=this.el.dom.offsetWidth;var j=this.el.dom.clientWidth;var b=this.stripWrap;var g=b.dom.offsetWidth;var f=this.edge.getOffsetsTo(this.stripWrap)[0];if(!this.enableMenu||k<1||g<20){return;}b.setWidth(j);if(f<=j){if(this.showingMenu){this.showingMenu=false;this.menuButton.hide();}}else{j-=b.getMargins("lr");b.setWidth(j>20?j:20);if(!this.showingMenu){if(!this.menuButton){this.createMenuButton();}else{this.menuButton.show();}}mo=this.getMenuButtonPos();for(var h=k-1;h>=0;h--){var a=this.items[h].el.dom.offsetLeft+this.items[h].el.dom.offsetWidth;if(a>mo){this.items[h].hide();var c=this.items[h].initialConfig,d={iconCls:c.iconCls,handler:c.handler,scope:c.scope,text:c.menuText};this.menuAdd(d);}else{this.items[h].show();}}this.showingMenu=true;}},createMenuButton:function(){var b=this.el.dom.offsetHeight;var c=this.el.insertFirst({cls:"ux-quickstart-menubutton-wrap"});c.setHeight(b);var a=new Ext.Button({cls:"x-btn-icon",id:"ux-quickstart-menubutton",menu:this.menu,renderTo:c});c.setWidth(Ext.get("ux-quickstart-menubutton").getWidth());this.menuButton=c;},getMenuButtonPos:function(){return this.menuButton.dom.offsetLeft;}});