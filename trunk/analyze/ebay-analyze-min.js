Ext.onReady(function(){Ext.BLANK_IMAGE_URL="../../Ext/2.2/resources/images/default/s.gif";var b=new Ext.state.CookieProvider({path:"/eBayBO/analyze/",expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(b);var a=new Ext.LoadMask(Ext.getBody(),{msg:"Please wait..."});com.ebay.widgets.needs({baseUrl:"http://w-1.ebay.com/js/607/min/",files:["FindItemsAdvanced.js","GetSingleItem.js"],resources:[].concat(com.ebay.shoppingservice.Shopping.getSingleItem,com.ebay.shoppingservice.Shopping.findItemsAdvanced),callback:function(){var d=new Ext.data.ArrayReader({},[{name:"itemID"},{name:"userID"},{name:"title"},{name:"buyItNowAvailable"},{name:"currentPrice"},{name:"shippingServiceCost"},{name:"quantity"},{name:"quantitySold"},{name:"galleryURL"},{name:"startTime"},{name:"endTime",type:"date",dateFormat:"y-m-d H:i:s"},{name:"listingType"},{name:"listingStatus"},{name:"ViewItemURLForNaturalSearch"}]);var i=new Ext.data.Store({reader:d,url:"service.php"});function l(w,y,x){return String.format('<img src="{0}"/>',w)}function v(w,y,x){if(w.substr(3)=="0"||w.substr(3)==0){return String.format('<font color="red">{0}</font>',w)}else{return String.format('<font color="green">{0}</font>',w)}}function r(w,y,x){return x.data.endTime.getElapsed(x.data.startTime)/(24*60*60*1000)}function m(w,y,x){if(w){return"Y"}else{return"N"}}var g=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"country",hiddenName:"country",listWidth:50,width:50});var t=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR","HK"],triggerAction:"all",editable:false,selectOnFocus:true,name:"located",hiddenName:"located",listWidth:50,width:50});var n=1;var k=1;function e(z){k=z.totalPages;Ext.getCmp("page-nav").setText(n+"/"+k);var A=0;var w=new Array();var C=0;var B=function(H){var G=new Array();G[0]=H.item.itemID;G[1]=H.item.seller.userID;G[2]=H.item.title;G[3]=H.item.buyItNowAvailable;G[4]=H.item.currentPrice.currencyID+H.item.currentPrice.value;G[5]=H.item.shippingCostSummary.shippingServiceCost.currencyID+H.item.shippingCostSummary.shippingServiceCost.value;G[6]=H.item.quantity;G[7]=H.item.quantitySold;G[8]=H.item.galleryURL;G[9]=H.item.startTime;G[10]=H.item.endTime;G[11]=H.item.listingType.value;G[12]=H.item.listingStatus.value;G[13]=H.item.viewItemURLForNaturalSearch;w.push(G);A++;if(A==C){i.loadData(w);a.hide()}};var F=function(G){a.hide();Ext.Msg.alert("Warn",G.longMessage)};if(!Ext.isEmpty(z.searchResult)&&Ext.isArray(z.searchResult[0].itemArray.item)){C=z.searchResult[0].itemArray.item.length;a.show();for(j in z.searchResult[0].itemArray.item){if(!Ext.isEmpty(z.searchResult[0].itemArray.item[j].itemID)){var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var D=new com.ebay.shoppingservice.Shopping(x);var y=new com.ebay.shoppingservice.GetSingleItemRequestType({ItemID:z.searchResult[0].itemArray.item[j].itemID,IncludeSelector:"Details,ShippingCosts"});var E=new com.ebay.shoppingservice.ShoppingCallback({success:B,failure:F});D.getSingleItem(y,E)}}}else{Ext.Msg.alert("Warn","No Result!");i.removeAll()}}function s(w){a.hide();Ext.Msg.alert(w[0].severityCode.value,w[0].longMessage)}var q=function(){switch(g.getValue()){case"US":var w="USD";break;case"GB":var w="GBP";break;case"AU":var w="AUD";break;case"FR":var w="EUR";break}var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(x);n=1;var y=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:n,Currency:w,ItemsAvailableTo:g.getValue(),ItemsLocatedIn:t.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var A=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:s});z.findItemsAdvanced(y,A)};var p=function(){switch(g.getValue()){case"US":var w="USD";break;case"GB":var w="GBP";break;case"AU":var w="AUD";break;case"FR":var w="EUR";break}var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(x);n--;var y=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:n,Currency:w,ItemsAvailableTo:g.getValue(),ItemsLocatedIn:t.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var A=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:s});z.findItemsAdvanced(y,A)};var o=function(){switch(g.getValue()){case"US":var w="USD";break;case"GB":var w="GBP";break;case"AU":var w="AUD";break;case"FR":var w="EUR";break}var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(x);n++;var y=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:n,Currency:w,ItemsAvailableTo:g.getValue(),ItemsLocatedIn:t.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var A=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:s});z.findItemsAdvanced(y,A)};var h=function(){switch(g.getValue()){case"US":var w="USD";break;case"GB":var w="GBP";break;case"AU":var w="AUD";break;case"FR":var w="EUR";break}var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(x);n=k;var y=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:n,Currency:w,ItemsAvailableTo:g.getValue(),ItemsLocatedIn:t.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var A=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:s});z.findItemsAdvanced(y,A)};var f=function(){switch(g.getValue()){case"US":var w="USD";break;case"GB":var w="GBP";break;case"AU":var w="AUD";break;case"FR":var w="EUR";break}var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(x);var y=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:n,Currency:w,ItemsAvailableTo:g.getValue(),ItemsLocatedIn:t.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var A=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:s});z.findItemsAdvanced(y,A)};var c=new Ext.grid.GridPanel({title:'eBay Item Analyze (<font color="red">you want to specify multiple Seller, use a comma.</font>)',autoHeight:true,store:i,autoScroll:true,width:1400,height:768,selModel:new Ext.grid.RowSelectionModel({}),columns:[{header:"Image",width:100,align:"center",sortable:true,dataIndex:"galleryURL",renderer:l},{header:"Seller ID",width:80,align:"center",sortable:true,dataIndex:"userID"},{header:"Title",width:320,align:"center",sortable:true,dataIndex:"title"},{header:"B I N",width:35,align:"center",sortable:true,dataIndex:"buyItNowAvailable",renderer:m},{header:"Type",width:85,align:"center",sortable:true,dataIndex:"listingType"},{header:"Price",width:58,align:"center",sortable:true,dataIndex:"currentPrice"},{header:"Shipping Cost",width:85,align:"center",sortable:true,dataIndex:"shippingServiceCost",renderer:v},{header:"Listing Q",width:60,align:"center",sortable:true,dataIndex:"quantity"},{header:"Sold Q",width:55,align:"center",sortable:true,dataIndex:"quantitySold"},{header:"Start Time",width:130,align:"center",sortable:true,dataIndex:"startTime"},{header:"End Time",width:130,align:"center",sortable:true,dataIndex:"endTime"},{header:"Listing Days",width:70,align:"center",sortable:true,dataIndex:"startTime",renderer:r}],bbar:[new Ext.Toolbar.Button({tooltip:"First Page",overflowText:"First Page",iconCls:"x-tbar-page-first",handler:q}),new Ext.Toolbar.Button({tooltip:"Previous Page",overflowText:"Previous Page",iconCls:"x-tbar-page-prev",handler:p}),"-",{id:"page-nav",xtype:"label",text:n+"/"+k},"-",new Ext.Toolbar.Button({tooltip:"Next Page",overflowText:"Next Page",iconCls:"x-tbar-page-next",handler:o}),new Ext.Toolbar.Button({tooltip:"Last Page",overflowText:"Last Page",iconCls:"x-tbar-page-last",handler:h}),"-",new Ext.Toolbar.Button({tooltip:"Refresh",overflowText:"Refresh",iconCls:"x-tbar-loading",handler:f})],tbar:[{xtype:"tbtext",text:"Country:"},g,{xtype:"tbtext",text:"Located:"},t,{xtype:"tbtext",text:"Store Name:"},{id:"storeName",name:"storeName",xtype:"textfield",width:120,listeners:{change:function(w,y,x){if(y.length>0){Ext.getCmp("seller").disable()}else{Ext.getCmp("seller").enable()}}}},"-",{xtype:"tbtext",text:"Seller:"},{id:"seller",name:"seller",xtype:"textfield",stateful:true,width:150},{text:"Select",handler:function(){var z=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var x=b.get("sellerArray");for(var y in x){if(Ext.type(x[y])=="string"){var A=new Ext.form.Checkbox({fieldLabel:(y==0)?"Seller":"",labelSeparator:(y==0)?":":"",boxLabel:x[y],name:x[y]});z.add(A)}}var w=new Ext.Window({autoScroll:true,title:"Select Seller",buttonAlign:"center",width:400,height:500,items:z,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var C="";for(var B in z.items.items){if(!Ext.isEmpty(z.items.items[B].name)){if(z.items.items[B].checked==true){C=C+z.items.items[B].name+","}}}C=C.substr(0,C.length-1);Ext.getCmp("seller").setValue(C);w.close()}},{text:"Add Seller",handler:function(){var C=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Seller",name:"seller"}]});var B=new Ext.Window({title:"Add Seller",width:300,height:100,items:C,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var D=C.getForm().findField("seller").getValue();var F=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:D,name:D});z.add(F);var E=b.get("sellerArray");if(Ext.isEmpty(E)){E=new Array();E.push(D);b.set("sellerArray",E)}else{E.push(D);b.set("sellerArray",E)}w.doLayout();B.close()}},{text:"Close",handler:function(){B.close()}}]});B.show()}},{text:"Delete Selected",handler:function(){for(var D in z.items.items){if(!Ext.isEmpty(z.items.items[D].name)){if(z.items.items[D].checked==true){var B=b.get("sellerArray");for(var C in B){console.log([z.items.items[D].name,B[C]]);if(z.items.items[D].name==B[C]){B[C]=B[0];B.shift();z.items.items[D].destroy()}}}}}console.log(B);b.set("sellerArray",B);z.doLayout();w.doLayout()}},{text:"Close",handler:function(){w.close()}}]});w.show()}},"-",{xtype:"tbtext",text:"Keyword:"},{id:"keyword",name:"keyword",xtype:"textfield",width:150},{text:"Select",handler:function(){var y=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var w=b.get("keywordArray");for(var x in w){if(Ext.type(w[x])=="string"){var A=new Ext.form.Checkbox({fieldLabel:(x==0)?"KeyWord":"",labelSeparator:(x==0)?":":"",boxLabel:w[x],name:w[x]});y.add(A)}}var z=new Ext.Window({autoScroll:true,title:"Select Keyword",buttonAlign:"center",width:400,height:500,items:y,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var C="";for(var B in y.items.items){if(!Ext.isEmpty(y.items.items[B].name)){if(y.items.items[B].checked==true){C=C+y.items.items[B].name+"%20"}}}C=C.substr(0,C.length-3);Ext.getCmp("keyword").setValue(C);z.close()}},{text:"Add Keyword",handler:function(){var C=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Keyword",name:"keyword"}]});var B=new Ext.Window({title:"Add Keyword",width:300,height:100,items:C,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var D=C.getForm().findField("keyword").getValue();var F=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:D,name:D});y.add(F);var E=b.get("keywordArray");if(Ext.isEmpty(E)){E=new Array();E.push(D);b.set("keywordArray",E)}else{E.push(D);b.set("keywordArray",E)}z.doLayout();B.close()}},{text:"Close",handler:function(){B.close()}}]});B.show()}},{text:"Delete Selected",handler:function(){for(var D in y.items.items){if(!Ext.isEmpty(y.items.items[D].name)){if(y.items.items[D].checked==true){var C=b.get("keywordArray");for(var B in C){console.log([y.items.items[D].name,C[B]]);if(y.items.items[D].name==C[B]){C[B]=C[0];C.shift();y.items.items[D].destroy()}}}}}console.log(C);b.set("keywordArray",C);y.doLayout();z.doLayout()}},{text:"Close",handler:function(){z.close()}}]});z.show()}},"-",{xtype:"tbtext",text:"End date from:"},{id:"from",name:"from",xtype:"datefield",format:"Y-m-d",listWidth:83,width:83},"-",{xtype:"tbtext",text:"End date to:"},{id:"to",name:"to",xtype:"datefield",format:"Y-m-d",listWidth:83,width:83},{text:"Submit",handler:function(){switch(g.getValue()){case"US":var w="USD";break;case"GB":var w="GBP";break;case"AU":var w="AUD";break;case"FR":var w="EUR";break}var x=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(x);var y=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:1,Currency:w,ItemsAvailableTo:g.getValue(),ItemsLocatedIn:t.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var A=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:s});z.findItemsAdvanced(y,A)}}]});c.on("rowdblclick",function(x){var w=x.getSelectionModel().getSelected();window.open(w.data.ViewItemURLForNaturalSearch,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1024, height=768")});var u=new Ext.Viewport({layout:"border",items:[{region:"center",autoScroll:true,items:c}]})}})});