Ext.onReady(function(){Ext.BLANK_IMAGE_URL="../../Ext/2.2/resources/images/default/s.gif";var b=new Ext.state.CookieProvider({path:"/eBayBO/analyze/",expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(b);var a=new Ext.LoadMask(Ext.getBody(),{msg:"Please wait..."});com.ebay.widgets.needs({baseUrl:"http://w-1.ebay.com/js/607/min/",files:["FindItemsAdvanced.js","GetSingleItem.js"],resources:[].concat(com.ebay.shoppingservice.Shopping.getSingleItem,com.ebay.shoppingservice.Shopping.findItemsAdvanced),callback:function(){var c=new Ext.data.ArrayReader({},[{name:"itemID"},{name:"userID"},{name:"title"},{name:"buyItNowAvailable"},{name:"currentPrice"},{name:"shippingServiceCost"},{name:"quantity"},{name:"quantitySold"},{name:"galleryURL"},{name:"startTime"},{name:"endTime",type:"date",dateFormat:"y-m-d H:i:s"},{name:"listingType"},{name:"listingStatus"},{name:"ViewItemURLForNaturalSearch"}]);var e=new Ext.data.Store({reader:c});function k(l,n,m){return String.format('<img src="{0}"/>',l)}function d(l,n,m){if(l.substr(3)=="0"||l.substr(3)==0){return String.format('<font color="red">{0}</font>',l)}else{return String.format('<font color="green">{0}</font>',l)}}function g(l,n,m){return m.data.endTime.getElapsed(m.data.startTime)/(24*60*60*1000)}var f=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"country",hiddenName:"country",listWidth:50,width:50});var i=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"located",hiddenName:"located",listWidth:50,width:50});var h=new Ext.grid.GridPanel({title:'eBay Item Analyze (<font color="red">you want to specify multiple Seller, use a comma.</font>)',autoHeight:true,store:e,autoScroll:true,width:1400,selModel:new Ext.grid.RowSelectionModel({}),columns:[{header:"Image",width:100,align:"center",sortable:true,dataIndex:"galleryURL",renderer:k},{header:"Seller ID",width:80,align:"center",sortable:true,dataIndex:"userID"},{header:"Title",width:320,align:"center",sortable:true,dataIndex:"title"},{header:"Buy It Now",width:70,align:"center",sortable:true,dataIndex:"buyItNowAvailable"},{header:"Price",width:55,align:"center",sortable:true,dataIndex:"currentPrice"},{header:"Shipping Cost",width:100,align:"center",sortable:true,dataIndex:"shippingServiceCost",renderer:d},{header:"Listing Q",width:60,align:"center",sortable:true,dataIndex:"quantity"},{header:"Sold Q",width:60,align:"center",sortable:true,dataIndex:"quantitySold"},{header:"Start Time",width:130,align:"center",sortable:true,dataIndex:"startTime"},{header:"End Time",width:130,align:"center",sortable:true,dataIndex:"endTime"},{header:"Listing Days",width:80,align:"center",sortable:true,dataIndex:"startTime",renderer:g},{header:"Type",width:60,align:"center",sortable:true,dataIndex:"listingType"},{header:"Status",width:60,align:"center",sortable:true,dataIndex:"listingStatus"}],tbar:[{xtype:"tbtext",text:"Country:"},f,{xtype:"tbtext",text:"Located:"},i,{xtype:"tbtext",text:"Store Name:"},{id:"storeName",name:"storeName",xtype:"textfield",width:120,listeners:{change:function(l,p,m){if(p.length>0){Ext.getCmp("seller").disable()}else{Ext.getCmp("seller").enable()}}}},"-",{xtype:"tbtext",text:"Seller:"},{id:"seller",name:"seller",xtype:"textfield",stateful:true,width:200},{text:"Select",handler:function(){var o=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var m=b.get("sellerArray");for(var n in m){if(Ext.type(m[n])=="string"){var p=new Ext.form.Checkbox({fieldLabel:(n==0)?"Seller":"",labelSeparator:(n==0)?":":"",boxLabel:m[n],name:m[n]});o.add(p)}}var l=new Ext.Window({autoScroll:true,title:"Select Seller",buttonAlign:"center",width:400,height:500,items:o,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var r="";for(var q in o.items.items){if(!Ext.isEmpty(o.items.items[q].name)){if(o.items.items[q].checked==true){r=r+o.items.items[q].name+","}}}r=r.substr(0,r.length-1);Ext.getCmp("seller").setValue(r);l.close()}},{text:"Add Seller",handler:function(){var r=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Seller",name:"seller"}]});var q=new Ext.Window({title:"Add Seller",width:300,height:100,items:r,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var s=r.getForm().findField("seller").getValue();var u=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:s,name:s});o.add(u);var t=b.get("sellerArray");if(Ext.isEmpty(t)){t=new Array();t.push(s);b.set("sellerArray",t)}else{t.push(s);b.set("sellerArray",t)}l.doLayout();q.close()}},{text:"Close",handler:function(){q.close()}}]});q.show()}},{text:"Delete Selected",handler:function(){for(var s in o.items.items){if(!Ext.isEmpty(o.items.items[s].name)){if(o.items.items[s].checked==true){var q=b.get("sellerArray");for(var r in q){console.log([o.items.items[s].name,q[r]]);if(o.items.items[s].name==q[r]){q[r]=q[0];q.shift();o.items.items[s].destroy()}}}}}console.log(q);b.set("sellerArray",q);o.doLayout();l.doLayout()}},{text:"Close",handler:function(){l.close()}}]});l.show()}},"-",{xtype:"tbtext",text:"Keyword:"},{id:"keyword",name:"keyword",xtype:"textfield",width:150},{text:"Select",handler:function(){var n=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var l=b.get("keywordArray");for(var m in l){if(Ext.type(l[m])=="string"){var p=new Ext.form.Checkbox({fieldLabel:(m==0)?"KeyWord":"",labelSeparator:(m==0)?":":"",boxLabel:l[m],name:l[m]});n.add(p)}}var o=new Ext.Window({autoScroll:true,title:"Select Keyword",buttonAlign:"center",width:400,height:500,items:n,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var r="";for(var q in n.items.items){if(!Ext.isEmpty(n.items.items[q].name)){if(n.items.items[q].checked==true){r=r+n.items.items[q].name+"%20"}}}r=r.substr(0,r.length-3);Ext.getCmp("keyword").setValue(r);o.close()}},{text:"Add Keyword",handler:function(){var r=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Keyword",name:"keyword"}]});var q=new Ext.Window({title:"Add Keyword",width:300,height:100,items:r,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var s=r.getForm().findField("keyword").getValue();var u=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:s,name:s});n.add(u);var t=b.get("keywordArray");if(Ext.isEmpty(t)){t=new Array();t.push(s);b.set("keywordArray",t)}else{t.push(s);b.set("keywordArray",t)}o.doLayout();q.close()}},{text:"Close",handler:function(){q.close()}}]});q.show()}},{text:"Delete Selected",handler:function(){for(var s in n.items.items){if(!Ext.isEmpty(n.items.items[s].name)){if(n.items.items[s].checked==true){var r=b.get("keywordArray");for(var q in r){console.log([n.items.items[s].name,r[q]]);if(n.items.items[s].name==r[q]){r[q]=r[0];r.shift();n.items.items[s].destroy()}}}}}console.log(r);b.set("keywordArray",r);n.doLayout();o.doLayout()}},{text:"Close",handler:function(){o.close()}}]});o.show()}},"-",{xtype:"tbtext",text:"End date from:"},{id:"from",name:"from",xtype:"datefield",format:"Y-m-d"},"-",{xtype:"tbtext",text:"End date to:"},{id:"to",name:"to",xtype:"datefield",format:"Y-m-d"},{text:"Submit",handler:function(){function o(v){var w=0;var s=new Array();var y=0;var x=function(D){var C=new Array();C[0]=D.item.itemID;C[1]=D.item.seller.userID;C[2]=D.item.title;C[3]=D.item.buyItNowAvailable;C[4]=D.item.currentPrice.currencyID+D.item.currentPrice.value;C[5]=D.item.shippingCostSummary.shippingServiceCost.currencyID+D.item.shippingCostSummary.shippingServiceCost.value;C[6]=D.item.quantity;C[7]=D.item.quantitySold;C[8]=D.item.galleryURL;C[9]=D.item.startTime;C[10]=D.item.endTime;C[11]=D.item.listingType.value;C[12]=D.item.listingStatus.value;C[13]=D.item.viewItemURLForNaturalSearch;s.push(C);w++;if(w==y){e.loadData(s);a.hide()}};var B=function(C){a.hide();Ext.Msg.alert("Warn",C.longMessage)};if(!Ext.isEmpty(v.searchResult)&&Ext.isArray(v.searchResult[0].itemArray.item)){y=v.searchResult[0].itemArray.item.length;a.show();for(j in v.searchResult[0].itemArray.item){if(!Ext.isEmpty(v.searchResult[0].itemArray.item[j].itemID)){var t=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var z=new com.ebay.shoppingservice.Shopping(t);var u=new com.ebay.shoppingservice.GetSingleItemRequestType({ItemID:v.searchResult[0].itemArray.item[j].itemID,IncludeSelector:"Details,ShippingCosts"});var A=new com.ebay.shoppingservice.ShoppingCallback({success:x,failure:B});z.getSingleItem(u,A)}}}else{Ext.Msg.alert("Warn","No Result!");e.removeAll()}}function m(s){a.hide();Ext.Msg.alert(s[0].severityCode.value,s[0].longMessage)}var n=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var q=new com.ebay.shoppingservice.Shopping(n);switch(f.getValue()){case"US":var l="USD";break;case"GB":var l="GBP";break;case"AU":var l="AUD";break;case"FR":var l="EUR";break}var p=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({Currency:l,ItemsAvailableTo:f.getValue(),ItemsLocatedIn:i.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:10,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var r=new com.ebay.shoppingservice.ShoppingCallback({success:o,failure:m});q.findItemsAdvanced(p,r)}}]});h.on("rowdblclick",function(m){var l=m.getSelectionModel().getSelected();window.open(l.data.ViewItemURLForNaturalSearch,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1024, height=768")});h.render("analyze-grid")}})});