Ext.onReady(function(){Ext.BLANK_IMAGE_URL="../../Ext/2.2/resources/images/default/s.gif";var b=new Ext.state.CookieProvider({path:"/eBayBO/analyze/",expires:new Date(new Date().getTime()+(1000*60*60*24*365))});Ext.state.Manager.setProvider(b);var a=new Ext.LoadMask(Ext.getBody(),{msg:"Please wait..."});com.ebay.widgets.needs({baseUrl:"http://w-1.ebay.com/js/607/min/",files:["FindItemsAdvanced.js","GetSingleItem.js"],resources:[].concat(com.ebay.shoppingservice.Shopping.getSingleItem,com.ebay.shoppingservice.Shopping.findItemsAdvanced),callback:function(){var d=new Ext.data.ArrayReader({},[{name:"itemID"},{name:"userID"},{name:"title"},{name:"buyItNowAvailable"},{name:"currentPrice"},{name:"shippingServiceCost"},{name:"quantity"},{name:"quantitySold"},{name:"galleryURL"},{name:"startTime"},{name:"endTime",type:"date",dateFormat:"y-m-d H:i:s"},{name:"listingType"},{name:"listingStatus"},{name:"ViewItemURLForNaturalSearch"}]);var h=new Ext.data.Store({reader:d,url:"service.php"});function k(w,y,x){return String.format('<img src="{0}"/>',w)}function u(w,y,x){if(w.substr(3)=="0"||w.substr(3)==0){return String.format('<font color="red">{0}</font>',w)}else{return String.format('<font color="green">{0}</font>',w)}}function q(w,y,x){return x.data.endTime.getElapsed(x.data.startTime)/(24*60*60*1000)}function l(w,y,x){if(w){return"Y"}else{return"N"}}var f=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"country",hiddenName:"country",listWidth:50,width:50});var s=new Ext.form.ComboBox({mode:"local",store:["US","GB","AU","FR"],triggerAction:"all",editable:false,selectOnFocus:true,name:"located",hiddenName:"located",listWidth:50,width:50});var m=1;var i=1;function e(y){i=y.totalPages;Ext.getCmp("page-nav").setText(m+"/"+i);var z=0;var v=new Array();var B=0;var A=function(G){var F=new Array();F[0]=G.item.itemID;F[1]=G.item.seller.userID;F[2]=G.item.title;F[3]=G.item.buyItNowAvailable;F[4]=G.item.currentPrice.currencyID+G.item.currentPrice.value;F[5]=G.item.shippingCostSummary.shippingServiceCost.currencyID+G.item.shippingCostSummary.shippingServiceCost.value;F[6]=G.item.quantity;F[7]=G.item.quantitySold;F[8]=G.item.galleryURL;F[9]=G.item.startTime;F[10]=G.item.endTime;F[11]=G.item.listingType.value;F[12]=G.item.listingStatus.value;F[13]=G.item.viewItemURLForNaturalSearch;v.push(F);z++;if(z==B){h.loadData(v);a.hide()}};var E=function(F){a.hide();Ext.Msg.alert("Warn",F.longMessage)};if(!Ext.isEmpty(y.searchResult)&&Ext.isArray(y.searchResult[0].itemArray.item)){B=y.searchResult[0].itemArray.item.length;a.show();for(j in y.searchResult[0].itemArray.item){if(!Ext.isEmpty(y.searchResult[0].itemArray.item[j].itemID)){var w=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var C=new com.ebay.shoppingservice.Shopping(w);var x=new com.ebay.shoppingservice.GetSingleItemRequestType({ItemID:y.searchResult[0].itemArray.item[j].itemID,IncludeSelector:"Details,ShippingCosts"});var D=new com.ebay.shoppingservice.ShoppingCallback({success:A,failure:E});C.getSingleItem(x,D)}}}else{Ext.Msg.alert("Warn","No Result!");h.removeAll()}}function r(v){a.hide();Ext.Msg.alert(v[0].severityCode.value,v[0].longMessage)}var p=function(){switch(f.getValue()){case"US":var v="USD";break;case"GB":var v="GBP";break;case"AU":var v="AUD";break;case"FR":var v="EUR";break}var w=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var y=new com.ebay.shoppingservice.Shopping(w);m=1;var x=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:m,Currency:v,ItemsAvailableTo:f.getValue(),ItemsLocatedIn:s.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var z=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:r});y.findItemsAdvanced(x,z)};var o=function(){switch(f.getValue()){case"US":var v="USD";break;case"GB":var v="GBP";break;case"AU":var v="AUD";break;case"FR":var v="EUR";break}var w=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var y=new com.ebay.shoppingservice.Shopping(w);m--;var x=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:m,Currency:v,ItemsAvailableTo:f.getValue(),ItemsLocatedIn:s.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var z=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:r});y.findItemsAdvanced(x,z)};var n=function(){switch(f.getValue()){case"US":var v="USD";break;case"GB":var v="GBP";break;case"AU":var v="AUD";break;case"FR":var v="EUR";break}var w=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var y=new com.ebay.shoppingservice.Shopping(w);m++;var x=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:m,Currency:v,ItemsAvailableTo:f.getValue(),ItemsLocatedIn:s.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var z=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:r});y.findItemsAdvanced(x,z)};var g=function(){switch(f.getValue()){case"US":var v="USD";break;case"GB":var v="GBP";break;case"AU":var v="AUD";break;case"FR":var v="EUR";break}var w=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var y=new com.ebay.shoppingservice.Shopping(w);m=i;var x=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:m,Currency:v,ItemsAvailableTo:f.getValue(),ItemsLocatedIn:s.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var z=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:r});y.findItemsAdvanced(x,z)};var c=new Ext.grid.GridPanel({title:'eBay Item Analyze (<font color="red">you want to specify multiple Seller, use a comma.</font>)',autoHeight:true,store:h,autoScroll:true,selModel:new Ext.grid.RowSelectionModel({}),columns:[{header:"Image",width:100,align:"center",sortable:true,dataIndex:"galleryURL",renderer:k},{header:"Seller ID",width:80,align:"center",sortable:true,dataIndex:"userID"},{header:"Title",width:320,align:"center",sortable:true,dataIndex:"title"},{header:"B I N",width:35,align:"center",sortable:true,dataIndex:"buyItNowAvailable",renderer:l},{header:"Type",width:85,align:"center",sortable:true,dataIndex:"listingType"},{header:"Price",width:58,align:"center",sortable:true,dataIndex:"currentPrice"},{header:"Shipping Cost",width:85,align:"center",sortable:true,dataIndex:"shippingServiceCost",renderer:u},{header:"Listing Q",width:60,align:"center",sortable:true,dataIndex:"quantity"},{header:"Sold Q",width:55,align:"center",sortable:true,dataIndex:"quantitySold"},{header:"Start Time",width:130,align:"center",sortable:true,dataIndex:"startTime"},{header:"End Time",width:130,align:"center",sortable:true,dataIndex:"endTime"},{header:"Listing Days",width:70,align:"center",sortable:true,dataIndex:"startTime",renderer:q}],bbar:[new Ext.Toolbar.Button({tooltip:"First Page",overflowText:"First Page",iconCls:"x-tbar-page-first",handler:p}),new Ext.Toolbar.Button({tooltip:"Previous Page",overflowText:"Previous Page",iconCls:"x-tbar-page-prev",handler:o}),"-",{id:"page-nav",xtype:"label",text:m+"/"+i},"-",new Ext.Toolbar.Button({tooltip:"Next Page",overflowText:"Next Page",iconCls:"x-tbar-page-next",handler:n}),new Ext.Toolbar.Button({tooltip:"Last Page",overflowText:"Last Page",iconCls:"x-tbar-page-last",handler:g})],tbar:[{xtype:"tbtext",text:"Country:"},f,{xtype:"tbtext",text:"Located:"},s,{xtype:"tbtext",text:"Store Name:"},{id:"storeName",name:"storeName",xtype:"textfield",width:120,listeners:{change:function(v,x,w){if(x.length>0){Ext.getCmp("seller").disable()}else{Ext.getCmp("seller").enable()}}}},"-",{xtype:"tbtext",text:"Seller:"},{id:"seller",name:"seller",xtype:"textfield",stateful:true,width:150},{text:"Select",handler:function(){var y=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var w=b.get("sellerArray");for(var x in w){if(Ext.type(w[x])=="string"){var z=new Ext.form.Checkbox({fieldLabel:(x==0)?"Seller":"",labelSeparator:(x==0)?":":"",boxLabel:w[x],name:w[x]});y.add(z)}}var v=new Ext.Window({autoScroll:true,title:"Select Seller",buttonAlign:"center",width:400,height:500,items:y,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var B="";for(var A in y.items.items){if(!Ext.isEmpty(y.items.items[A].name)){if(y.items.items[A].checked==true){B=B+y.items.items[A].name+","}}}B=B.substr(0,B.length-1);Ext.getCmp("seller").setValue(B);v.close()}},{text:"Add Seller",handler:function(){var B=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Seller",name:"seller"}]});var A=new Ext.Window({title:"Add Seller",width:300,height:100,items:B,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var C=B.getForm().findField("seller").getValue();var E=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:C,name:C});y.add(E);var D=b.get("sellerArray");if(Ext.isEmpty(D)){D=new Array();D.push(C);b.set("sellerArray",D)}else{D.push(C);b.set("sellerArray",D)}v.doLayout();A.close()}},{text:"Close",handler:function(){A.close()}}]});A.show()}},{text:"Delete Selected",handler:function(){for(var C in y.items.items){if(!Ext.isEmpty(y.items.items[C].name)){if(y.items.items[C].checked==true){var A=b.get("sellerArray");for(var B in A){console.log([y.items.items[C].name,A[B]]);if(y.items.items[C].name==A[B]){A[B]=A[0];A.shift();y.items.items[C].destroy()}}}}}console.log(A);b.set("sellerArray",A);y.doLayout();v.doLayout()}},{text:"Close",handler:function(){v.close()}}]});v.show()}},"-",{xtype:"tbtext",text:"Keyword:"},{id:"keyword",name:"keyword",xtype:"textfield",width:150},{text:"Select",handler:function(){var x=new Ext.FormPanel({width:280,defaultType:"checkbox",autoHeight:true});var v=b.get("keywordArray");for(var w in v){if(Ext.type(v[w])=="string"){var z=new Ext.form.Checkbox({fieldLabel:(w==0)?"KeyWord":"",labelSeparator:(w==0)?":":"",boxLabel:v[w],name:v[w]});x.add(z)}}var y=new Ext.Window({autoScroll:true,title:"Select Keyword",buttonAlign:"center",width:400,height:500,items:x,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var B="";for(var A in x.items.items){if(!Ext.isEmpty(x.items.items[A].name)){if(x.items.items[A].checked==true){B=B+x.items.items[A].name+"%20"}}}B=B.substr(0,B.length-3);Ext.getCmp("keyword").setValue(B);y.close()}},{text:"Add Keyword",handler:function(){var B=new Ext.FormPanel({autoHeight:true,items:[{xtype:"textfield",fieldLabel:"Keyword",name:"keyword"}]});var A=new Ext.Window({title:"Add Keyword",width:300,height:100,items:B,plain:true,layout:"fit",buttons:[{text:"OK",handler:function(){var C=B.getForm().findField("keyword").getValue();var E=new Ext.form.Checkbox({fieldLabel:"",labelSeparator:"",boxLabel:C,name:C});x.add(E);var D=b.get("keywordArray");if(Ext.isEmpty(D)){D=new Array();D.push(C);b.set("keywordArray",D)}else{D.push(C);b.set("keywordArray",D)}y.doLayout();A.close()}},{text:"Close",handler:function(){A.close()}}]});A.show()}},{text:"Delete Selected",handler:function(){for(var C in x.items.items){if(!Ext.isEmpty(x.items.items[C].name)){if(x.items.items[C].checked==true){var B=b.get("keywordArray");for(var A in B){console.log([x.items.items[C].name,B[A]]);if(x.items.items[C].name==B[A]){B[A]=B[0];B.shift();x.items.items[C].destroy()}}}}}console.log(B);b.set("keywordArray",B);x.doLayout();y.doLayout()}},{text:"Close",handler:function(){y.close()}}]});y.show()}},"-",{xtype:"tbtext",text:"End date from:"},{id:"from",name:"from",xtype:"datefield",format:"Y-m-d",listWidth:83,width:83},"-",{xtype:"tbtext",text:"End date to:"},{id:"to",name:"to",xtype:"datefield",format:"Y-m-d",listWidth:83,width:83},{text:"Submit",handler:function(){switch(f.getValue()){case"US":var v="USD";break;case"GB":var v="GBP";break;case"AU":var v="AUD";break;case"FR":var v="EUR";break}var w=new com.ebay.shoppingservice.ShoppingConfig({appId:"eBayAPID-73f4-45f2-b9a3-c8f6388b38d8"});var y=new com.ebay.shoppingservice.Shopping(w);var x=new com.ebay.shoppingservice.FindItemsAdvancedRequestType({PageNumber:1,Currency:v,ItemsAvailableTo:f.getValue(),ItemsLocatedIn:s.getValue(),QueryKeywords:Ext.getCmp("keyword").getValue(),StoreName:Ext.getCmp("storeName").getValue(),SellerID:Ext.getCmp("seller").getValue(),MaxEntries:50,EndTimeFrom:Ext.isEmpty(Ext.getCmp("from").getValue())?null:Ext.getCmp("from").getValue().format("Y-m-d"),EndTimeTo:Ext.isEmpty(Ext.getCmp("to").getValue())?null:Ext.getCmp("to").getValue().format("Y-m-d")});var z=new com.ebay.shoppingservice.ShoppingCallback({success:e,failure:r});y.findItemsAdvanced(x,z)}}]});c.on("rowdblclick",function(w){var v=w.getSelectionModel().getSelected();window.open(v.data.ViewItemURLForNaturalSearch,"_blank","toolbar=no, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=1024, height=768")});var t=new Ext.Viewport({layout:"border",items:[{region:"center",autoScroll:true,items:c}]})}})});